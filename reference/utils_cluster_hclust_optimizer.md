# Optimize the Silhouette Width of Hierarchical Clustering Solutions

Performs a parallelized grid search to find the number of clusters
maximizing the overall silhouette width of the clustering solution (see
[`utils_cluster_silhouette()`](https://blasbenito.github.io/distantia/reference/utils_cluster_silhouette.md)).
When `method = NULL`, the optimization also includes all methods
available in [`stats::hclust()`](https://rdrr.io/r/stats/hclust.html) in
the grid search. This function supports parallelization via
[`future::plan()`](https://future.futureverse.org/reference/plan.html)
and a progress bar generated by the `progressr` package (see Examples).

## Usage

``` r
utils_cluster_hclust_optimizer(d = NULL, method = NULL)
```

## Arguments

- d:

  (required, matrix) distance matrix typically resulting from
  [`distantia_matrix()`](https://blasbenito.github.io/distantia/reference/distantia_matrix.md),
  but any other square matrix should work. Default: NULL

- method:

  (optional, character string) Argument of
  [`stats::hclust()`](https://rdrr.io/r/stats/hclust.html) defining the
  agglomerative method. One of: "ward.D", "ward.D2", "single",
  "complete", "average" (= UPGMA), "mcquitty" (= WPGMA), "median" (=
  WPGMC) or "centroid" (= UPGMC). Unambiguous abbreviations are accepted
  as well.

  This function supports a parallelization setup via
  [`future::plan()`](https://future.futureverse.org/reference/plan.html),
  and progress bars provided by the package
  [progressr](https://CRAN.R-project.org/package=progressr).

## Value

data frame

## See also

Other distantia_support:
[`distantia_aggregate()`](https://blasbenito.github.io/distantia/reference/distantia_aggregate.md),
[`distantia_boxplot()`](https://blasbenito.github.io/distantia/reference/distantia_boxplot.md),
[`distantia_cluster_hclust()`](https://blasbenito.github.io/distantia/reference/distantia_cluster_hclust.md),
[`distantia_cluster_kmeans()`](https://blasbenito.github.io/distantia/reference/distantia_cluster_kmeans.md),
[`distantia_matrix()`](https://blasbenito.github.io/distantia/reference/distantia_matrix.md),
[`distantia_model_frame()`](https://blasbenito.github.io/distantia/reference/distantia_model_frame.md),
[`distantia_spatial()`](https://blasbenito.github.io/distantia/reference/distantia_spatial.md),
[`distantia_stats()`](https://blasbenito.github.io/distantia/reference/distantia_stats.md),
[`distantia_time_delay()`](https://blasbenito.github.io/distantia/reference/distantia_time_delay.md),
[`utils_block_size()`](https://blasbenito.github.io/distantia/reference/utils_block_size.md),
[`utils_cluster_kmeans_optimizer()`](https://blasbenito.github.io/distantia/reference/utils_cluster_kmeans_optimizer.md),
[`utils_cluster_silhouette()`](https://blasbenito.github.io/distantia/reference/utils_cluster_silhouette.md)

## Examples

``` r
#weekly covid prevalence
#in 10 California counties
#aggregated by month
tsl <- tsl_initialize(
  x = covid_prevalence,
  name_column = "name",
  time_column = "time"
) |>
  tsl_subset(
    names = 1:10
  ) |>
  tsl_aggregate(
    new_time = "months",
    fun = max
  )

if(interactive()){
  #plotting first three time series
  tsl_plot(
    tsl = tsl_subset(
      tsl = tsl,
      names = 1:3
    ),
    guide_columns = 3
  )
}

#compute dissimilarity matrix
psi_matrix <- distantia(
  tsl = tsl,
  lock_step = TRUE
) |>
  distantia_matrix()

#optimize hierarchical clustering
hclust_optimization <- utils_cluster_hclust_optimizer(
  d = psi_matrix
)

#best solution in first row
head(hclust_optimization)
#>   clusters   method silhouette_mean
#> 1        5   ward.D       0.3127728
#> 2        5  ward.D2       0.3127728
#> 3        5   single       0.3127728
#> 4        5 complete       0.3127728
#> 5        5  average       0.3127728
#> 6        5 mcquitty       0.3127728
```
