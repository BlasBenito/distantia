<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Dissimilarity Analysis of Time Series Lists — distantia • distantia</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Dissimilarity Analysis of Time Series Lists — distantia"><meta name="description" content='This function combines dynamic time warping or lock-step comparison with the psi dissimilarity score and permutation methods to assess dissimilarity between pairs time series or any other sort of data composed of events ordered across a relevant dimension.
Dynamic Time Warping (DTW) is an algorithm that finds the optimal alignment between two time series by minimizing the cumulative distance between them. It identifies the least-cost path through a distance matrix, which maps all points of one time series to another. The resulting sum of distances along this path serves as a measure of time series similarity. DTW disregards the exact timing of samples and focuses on their order, making it suitable for comparing both regular and irregular time series of the same or different lengths, such as phenological data from different latitudes or elevations, time series from various years or periods, and movement trajectories like migration paths.
On the other hand, the lock-step method sums pairwise distances between samples in regular or irregular time series of the same length, preferably captured at the same times. This method is an alternative to dynamic time warping when the goal is to assess the synchronicity of two time series.
The psi score normalizes the cumulative sum of distances between two time series by the cumulative sum of distances between their consecutive samples to generate a comparable dissimilarity score. If for two time series \(x\) and \(y\) \(D_xy\) represents the cumulative sum of distances between them, either resulting from dynamic time warping or the lock-step method, and \(S_xy\) represents the cumulative sum of distances of their consecutive samples, then the psi score can be computed in two ways depending on the scenario:
Equation 1: \(\psi = \frac{D_{xy} - S_{xy}}{S_{xy}}\)
Equation 2: \(\psi = \frac{D_{xy} - S_{xy}}{S_{xy}} + 1\)
When $D_xy$ is computed via dynamic time warping ignoring the distance matrix diagonals (diagonal = FALSE), then Equation 1 is used. On the other hand, if $D_xy$ results from the lock-step method (lock_step = TRUE), or from dynamic time warping considering diagonals (diagonal = TRUE), then Equation 2 is used instead:
In both equations, a psi score of zero indicates maximum similarity.
Permutation methods are provided here to help assess the robustness of observed psi scores by direct comparison with a null distribution of psi scores resulting from randomized versions of the compared time series. The fraction of null scores smaller than the observed score is returned as a p_value in the function output and interpreted as "the probability of finding a higher similarity (lower psi score) by chance".
In essence, restricted permutation is useful to answer the question "how robust is the similarity between two time series?"
Four different permutation methods are available:
"restricted": Separates the data into blocks of contiguous rows, and re-shuffles data points randomly within these blocks, independently by row and column. Applied when the data is structured in blocks that should be preserved during permutations (e.g., "seasons", "years", "decades", etc) and the columns represent independent variables.
"restricted_by_row": Separates the data into blocks of contiguous rows, and re-shuffles complete rows within these blocks. This method is suitable for cases where the data is organized into blocks as described above, but columns represent interdependent data (e.g., rows represent percentages or proportions), and maintaining the relationships between data within each row is important.
"free": Randomly re-shuffles data points across the entire time series, independently by row and column. This method is useful for loosely structured time series where data independence is assumed. When the data exhibits a strong temporal structure, this approach may lead to an overestimation of the robustness of dissimilarity scores.
"free_by_row": Randomly re-shuffles complete rows across the entire time series. This method is useful for loosely structured time series where dependency between columns is assumed (e.g., rows represent percentages or proportions). This method has the same drawbacks as the "free" method, when the data exhibits a strong temporal structure.


This function allows computing dissimilarity between pairs of time series using different combinations of arguments at once. For example, when the argument distance is set to c("euclidean", "manhattan"), the output data frame will show two dissimilarity scores for each pair of time series, one based on euclidean distances, and another based on manhattan distances. The same happens for most other parameters.
This function supports progress bars generated by the progressr package. See examples.
This function also accepts a parallelization setup via future::plan(), but it might only be worth it for large time series lists.'><meta property="og:description" content='This function combines dynamic time warping or lock-step comparison with the psi dissimilarity score and permutation methods to assess dissimilarity between pairs time series or any other sort of data composed of events ordered across a relevant dimension.
Dynamic Time Warping (DTW) is an algorithm that finds the optimal alignment between two time series by minimizing the cumulative distance between them. It identifies the least-cost path through a distance matrix, which maps all points of one time series to another. The resulting sum of distances along this path serves as a measure of time series similarity. DTW disregards the exact timing of samples and focuses on their order, making it suitable for comparing both regular and irregular time series of the same or different lengths, such as phenological data from different latitudes or elevations, time series from various years or periods, and movement trajectories like migration paths.
On the other hand, the lock-step method sums pairwise distances between samples in regular or irregular time series of the same length, preferably captured at the same times. This method is an alternative to dynamic time warping when the goal is to assess the synchronicity of two time series.
The psi score normalizes the cumulative sum of distances between two time series by the cumulative sum of distances between their consecutive samples to generate a comparable dissimilarity score. If for two time series \(x\) and \(y\) \(D_xy\) represents the cumulative sum of distances between them, either resulting from dynamic time warping or the lock-step method, and \(S_xy\) represents the cumulative sum of distances of their consecutive samples, then the psi score can be computed in two ways depending on the scenario:
Equation 1: \(\psi = \frac{D_{xy} - S_{xy}}{S_{xy}}\)
Equation 2: \(\psi = \frac{D_{xy} - S_{xy}}{S_{xy}} + 1\)
When $D_xy$ is computed via dynamic time warping ignoring the distance matrix diagonals (diagonal = FALSE), then Equation 1 is used. On the other hand, if $D_xy$ results from the lock-step method (lock_step = TRUE), or from dynamic time warping considering diagonals (diagonal = TRUE), then Equation 2 is used instead:
In both equations, a psi score of zero indicates maximum similarity.
Permutation methods are provided here to help assess the robustness of observed psi scores by direct comparison with a null distribution of psi scores resulting from randomized versions of the compared time series. The fraction of null scores smaller than the observed score is returned as a p_value in the function output and interpreted as "the probability of finding a higher similarity (lower psi score) by chance".
In essence, restricted permutation is useful to answer the question "how robust is the similarity between two time series?"
Four different permutation methods are available:
"restricted": Separates the data into blocks of contiguous rows, and re-shuffles data points randomly within these blocks, independently by row and column. Applied when the data is structured in blocks that should be preserved during permutations (e.g., "seasons", "years", "decades", etc) and the columns represent independent variables.
"restricted_by_row": Separates the data into blocks of contiguous rows, and re-shuffles complete rows within these blocks. This method is suitable for cases where the data is organized into blocks as described above, but columns represent interdependent data (e.g., rows represent percentages or proportions), and maintaining the relationships between data within each row is important.
"free": Randomly re-shuffles data points across the entire time series, independently by row and column. This method is useful for loosely structured time series where data independence is assumed. When the data exhibits a strong temporal structure, this approach may lead to an overestimation of the robustness of dissimilarity scores.
"free_by_row": Randomly re-shuffles complete rows across the entire time series. This method is useful for loosely structured time series where dependency between columns is assumed (e.g., rows represent percentages or proportions). This method has the same drawbacks as the "free" method, when the data exhibits a strong temporal structure.


This function allows computing dissimilarity between pairs of time series using different combinations of arguments at once. For example, when the argument distance is set to c("euclidean", "manhattan"), the output data frame will show two dissimilarity scores for each pair of time series, one based on euclidean distances, and another based on manhattan distances. The same happens for most other parameters.
This function supports progress bars generated by the progressr package. See examples.
This function also accepts a parallelization setup via future::plan(), but it might only be worth it for large time series lists.'><meta property="og:image" content="https://blasbenito.github.io/distantia/logo.png"><link rel="stylesheet" href="extra.css"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">distantia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/psi_dissimilarity_metric.html">The Psi Dissimilarity Metric</a></li>
    <li><a class="dropdown-item" href="../articles/dynamic_time_warping_and_lock_step.html">Comparing Time Series with distantia: DTW vs Lock-Step</a></li>
    <li><a class="dropdown-item" href="../articles/time_series_lists.html">Handling Time Series Lists</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Original Paper</h6></li>
    <li><a class="external-link dropdown-item" href="https://nsojournals.onlinelibrary.wiley.com/doi/full/10.1111/ecog.04895">Benito &amp; Birks 2020 (Ecography)</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BlasBenito/distantia/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Dissimilarity Analysis of Time Series Lists</h1>
      <small class="dont-index">Source: <a href="https://github.com/BlasBenito/distantia/blob/main/R/distantia.R" class="external-link"><code>R/distantia.R</code></a></small>
      <div class="d-none name"><code>distantia.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function combines <em>dynamic time warping</em> or <em>lock-step comparison</em> with the <em>psi dissimilarity score</em> and <em>permutation methods</em> to assess dissimilarity between pairs time series or any other sort of data composed of events ordered across a relevant dimension.</p>
<p><strong>Dynamic Time Warping</strong> (DTW) is an algorithm that finds the optimal alignment between two time series by minimizing the cumulative distance between them. It identifies the least-cost path through a distance matrix, which maps all points of one time series to another. The resulting sum of distances along this path serves as a measure of time series similarity. DTW disregards the exact timing of samples and focuses on their order, making it suitable for comparing both <em>regular and irregular time series of the same or different lengths</em>, such as phenological data from different latitudes or elevations, time series from various years or periods, and movement trajectories like migration paths.</p>
<p>On the other hand, the <strong>lock-step</strong> method sums pairwise distances between samples in <em>regular or irregular time series of the same length</em>, preferably captured at the same times. This method is an alternative to dynamic time warping when the goal is to assess the synchronicity of two time series.</p>
<p>The <strong>psi score</strong> normalizes the cumulative sum of distances between two time series by the cumulative sum of distances between their consecutive samples to generate a comparable dissimilarity score. If for two time series \(x\) and \(y\) \(D_xy\) represents the cumulative sum of distances between them, either resulting from dynamic time warping or the lock-step method, and \(S_xy\) represents the cumulative sum of distances of their consecutive samples, then the psi score can be computed in two ways depending on the scenario:</p>
<p><strong>Equation 1:</strong> \(\psi = \frac{D_{xy} - S_{xy}}{S_{xy}}\)</p>
<p><strong>Equation 2:</strong> \(\psi = \frac{D_{xy} - S_{xy}}{S_{xy}} + 1\)</p>
<p>When $D_xy$ is computed via dynamic time warping <strong>ignoring the distance matrix diagonals</strong> (<code>diagonal = FALSE</code>), then <em>Equation 1</em> is used. On the other hand, if $D_xy$ results from the lock-step method (<code>lock_step = TRUE</code>), or from dynamic time warping considering diagonals (<code>diagonal = TRUE</code>), then <em>Equation 2</em> is used instead:</p>
<p>In both equations, a psi score of zero indicates maximum similarity.</p>
<p><strong>Permutation methods</strong> are provided here to help assess the robustness of observed psi scores by direct comparison with a null distribution of psi scores resulting from randomized versions of the compared time series. The fraction of null scores smaller than the observed score is returned as a <em>p_value</em> in the function output and interpreted as "the probability of finding a higher similarity (lower psi score) by chance".</p>
<p>In essence, restricted permutation is useful to answer the question "how robust is the similarity between two time series?"</p>
<p>Four different permutation methods are available:</p><ul><li><p><strong>"restricted"</strong>: Separates the data into blocks of contiguous rows, and re-shuffles data points randomly within these blocks, independently by row and column. Applied when the data is structured in blocks that should be preserved during permutations (e.g., "seasons", "years", "decades", etc) and the columns represent independent variables.</p></li>
<li><p><strong>"restricted_by_row"</strong>: Separates the data into blocks of contiguous rows, and re-shuffles complete rows within these blocks. This method is suitable for cases where the data is organized into blocks as described above, but columns represent interdependent data (e.g., rows represent percentages or proportions), and maintaining the relationships between data within each row is important.</p></li>
<li><p><strong>"free"</strong>: Randomly re-shuffles data points across the entire time series, independently by row and column. This method is useful for loosely structured time series where data independence is assumed. When the data exhibits a strong temporal structure, this approach may lead to an overestimation of the robustness of dissimilarity scores.</p></li>
<li><p><strong>"free_by_row"</strong>: Randomly re-shuffles complete rows across the entire time series. This method is useful for loosely structured time series where dependency between columns is assumed (e.g., rows represent percentages or proportions). This method has the same drawbacks as the "free" method, when the data exhibits a strong temporal structure.</p></li>
</ul><p>This function allows computing dissimilarity between pairs of time series using different combinations of arguments at once. For example, when the argument <code>distance</code> is set to <code>c("euclidean", "manhattan")</code>, the output data frame will show two dissimilarity scores for each pair of time series, one based on euclidean distances, and another based on manhattan distances. The same happens for most other parameters.</p>
<p>This function supports progress bars generated by the <code>progressr</code> package. See examples.</p>
<p>This function also accepts a parallelization setup via <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code>, but it might only be worth it for large time series lists.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">distantia</span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  weighted <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ignore_blocks <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  repetitions <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  permutation <span class="op">=</span> <span class="st">"restricted_by_row"</span>,</span>
<span>  block_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tsl">tsl<a class="anchor" aria-label="anchor" href="#arg-tsl"></a></dt>
<dd><p>(required, time series list) list of zoo time series. Default: NULL</p></dd>


<dt id="arg-distance">distance<a class="anchor" aria-label="anchor" href="#arg-distance"></a></dt>
<dd><p>(optional, character vector) name or abbreviation of the distance method. Valid values are in the columns "names" and "abbreviation" of the dataset <a href="distances.html">distances</a>. Default: "euclidean".</p></dd>


<dt id="arg-diagonal">diagonal<a class="anchor" aria-label="anchor" href="#arg-diagonal"></a></dt>
<dd><p>(optional, logical vector). If TRUE, diagonals are included in the dynamic time warping computation. Default: TRUE</p></dd>


<dt id="arg-weighted">weighted<a class="anchor" aria-label="anchor" href="#arg-weighted"></a></dt>
<dd><p>(optional, logical vector) If TRUE, diagonal is set to TRUE, and diagonal cost is weighted by a factor of 1.414214. Default: TRUE</p></dd>


<dt id="arg-ignore-blocks">ignore_blocks<a class="anchor" aria-label="anchor" href="#arg-ignore-blocks"></a></dt>
<dd><p>(optional, logical vector). If TRUE, blocks of consecutive least cost path coordinates are trimmed to avoid inflating the psi dissimilarity Irrelevant if <code>diagonal = TRUE</code>. Default: FALSE.</p></dd>


<dt id="arg-lock-step">lock_step<a class="anchor" aria-label="anchor" href="#arg-lock-step"></a></dt>
<dd><p>(optional, logical vector) If TRUE, time series captured at the same times are compared sample wise (with no dynamic time warping). Requires time series in argument <code>tsl</code> to be fully aligned, or it will return an error. Default: FALSE.</p></dd>


<dt id="arg-repetitions">repetitions<a class="anchor" aria-label="anchor" href="#arg-repetitions"></a></dt>
<dd><p>(optional, integer vector) number of permutations to compute the p-value. If 0, p-values are not computed. Otherwise, the minimum is 2. The resolution of the p-values and the overall computation time depends on the number of permutations. Default: 0</p></dd>


<dt id="arg-permutation">permutation<a class="anchor" aria-label="anchor" href="#arg-permutation"></a></dt>
<dd><p>(optional, character vector) permutation method, only relevant when <code>repetitions</code> is higher than zero. Valid values are: "restricted_by_row", "restricted", "free_by_row", and "free". Default: "restricted_by_row".</p></dd>


<dt id="arg-block-size">block_size<a class="anchor" aria-label="anchor" href="#arg-block-size"></a></dt>
<dd><p>(optional, integer) Size of the row blocks for the restricted permutation test. Only relevant when permutation methods are "restricted" or "restricted_by_row" and <code>repetitions</code> is higher than zero. A block of size <code>n</code> indicates that a row can only be permuted within a block of <code>n</code> adjacent rows. If NULL, defaults to the rounded one tenth of the shortest time series in <code>tsl</code>. Default: NULL.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>(optional, integer) initial random seed to use for replicability when computing p-values. Default: 1</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>data frame with columns:</p><ul><li><p><code>x</code>: time series name.</p></li>
<li><p><code>y</code>: time series name.</p></li>
<li><p><code>distance</code>: name of the distance metric.</p></li>
<li><p><code>diagonal</code>: value of the argument <code>diagonal</code>.</p></li>
<li><p><code>weighted</code>: value of the argument <code>weighted</code>.</p></li>
<li><p><code>ignore_blocks</code>: value of the argument <code>ignore_blocks</code>.</p></li>
<li><p><code>lock_step</code>: value of the argument <code>lock_step</code>.</p></li>
<li><p><code>repetitions</code> (only if <code>repetitions &gt; 0</code>): value of the argument <code>repetitions</code>.</p></li>
<li><p><code>permutation</code> (only if <code>repetitions &gt; 0</code>): name of the permutation method used to compute p-values.</p></li>
<li><p><code>seed</code> (only if <code>repetitions &gt; 0</code>): random seed used to in the permutations.</p></li>
<li><p><code>psi</code>: psi dissimilarity of the sequences <code>x</code> and <code>y</code>.</p></li>
<li><p><code>null_mean</code> (only if <code>repetitions &gt; 0</code>): mean of the null distribution of psi scores.</p></li>
<li><p><code>null_sd</code> (only if <code>repetitions &gt; 0</code>): standard deviation of the null distribution of psi values.</p></li>
<li><p><code>p_value</code>  (only if <code>repetitions &gt; 0</code>): proportion of scores smaller or equal than <code>psi</code> in the null distribution.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other dissimilarity_analysis_main:
<code><a href="distantia_importance.html">distantia_importance</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#parallelization setup (not worth it for this data size)</span></span></span>
<span class="r-in"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span>,</span></span>
<span class="r-in"><span>  workers <span class="op">=</span> <span class="fl">2</span> <span class="co">#set to parallelly::availableCores() - 1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#progress bar</span></span></span>
<span class="r-in"><span><span class="co"># progressr::handlers(global = TRUE)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#three time series</span></span></span>
<span class="r-in"><span><span class="co">#climate and ndvi in Fagus sylvatica stands</span></span></span>
<span class="r-in"><span><span class="co">#in Spain, Germany, and Sweden</span></span></span>
<span class="r-in"><span><span class="co">#scaled and centered</span></span></span>
<span class="r-in"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="tsl_initialize.html">tsl_initialize</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">fagus_dynamics</span>,</span></span>
<span class="r-in"><span>  name_column <span class="op">=</span> <span class="st">"name"</span>,</span></span>
<span class="r-in"><span>  time_column <span class="op">=</span> <span class="st">"time"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    f <span class="op">=</span> <span class="va">f_scale</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> distantia::tsl_diagnose(): No issues found.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    tsl <span class="op">=</span> <span class="va">tsl</span>,</span></span>
<span class="r-in"><span>    guide_columns <span class="op">=</span> <span class="fl">3</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#dynamic time warping dissimilarity analysis</span></span></span>
<span class="r-in"><span><span class="co">#-------------------------------------------</span></span></span>
<span class="r-in"><span><span class="co">#permutation restricted by row because</span></span></span>
<span class="r-in"><span><span class="co">#ndvi depends on temperature and rainfall</span></span></span>
<span class="r-in"><span><span class="co">#block size is 6 because data is monthly</span></span></span>
<span class="r-in"><span><span class="co">#to keep permutation restricted to 6 months periods</span></span></span>
<span class="r-in"><span><span class="va">df_dtw</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="op">(</span></span></span>
<span class="r-in"><span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span></span>
<span class="r-in"><span>  distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span></span>
<span class="r-in"><span>  repetitions <span class="op">=</span> <span class="fl">10</span>, <span class="co">#increase to 100 or more</span></span></span>
<span class="r-in"><span>  permutation <span class="op">=</span> <span class="st">"restricted_by_row"</span>,</span></span>
<span class="r-in"><span>  block_size <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  seed <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> distantia::tsl_diagnose(): No issues found.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#focus on the important details</span></span></span>
<span class="r-in"><span><span class="va">df_dtw</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span>, <span class="st">"p_value"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         x      y       psi p_value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Germany Sweden 0.7018922     0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Germany  Spain 0.9947403     0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   Spain Sweden 1.1082660     0.1</span>
<span class="r-in"><span><span class="co">#smaller psi values indicate higher similarity</span></span></span>
<span class="r-in"><span><span class="co">#with small `repetitions` they all look the same though</span></span></span>
<span class="r-in"><span><span class="co">#p-values indicate chance of</span></span></span>
<span class="r-in"><span><span class="co">#finding a psi smaller than the observed</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#visualize dynamic time warping</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="distantia_plot.html">distantia_plot</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    tsl <span class="op">=</span> <span class="fu"><a href="tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      tsl <span class="op">=</span> <span class="va">tsl</span>,</span></span>
<span class="r-in"><span>      names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Spain"</span>, <span class="st">"Sweden"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span></span>
<span class="r-in"><span>    matrix_type <span class="op">=</span> <span class="st">"cost"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#recreating the null distribution</span></span></span>
<span class="r-in"><span><span class="co">#direct call to C++ function</span></span></span>
<span class="r-in"><span><span class="co">#use same args as in distantia() call</span></span></span>
<span class="r-in"><span><span class="va">psi_null</span> <span class="op">&lt;-</span> <span class="fu"><a href="null_psi_dynamic_time_warping_cpp.html">null_psi_dynamic_time_warping_cpp</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">tsl</span><span class="op">[[</span><span class="st">"Spain"</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">tsl</span><span class="op">[[</span><span class="st">"Sweden"</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  repetitions <span class="op">=</span> <span class="fl">10</span>, <span class="co">#increase to 100 or more</span></span></span>
<span class="r-in"><span>  distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span></span>
<span class="r-in"><span>  permutation <span class="op">=</span> <span class="st">"restricted_by_row"</span>,</span></span>
<span class="r-in"><span>  block_size <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  seed <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#compare null mean with output of distantia()</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">psi_null</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.52642</span>
<span class="r-in"><span><span class="va">df_dtw</span><span class="op">$</span><span class="va">null_mean</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.52642</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#disable parallelization</span></span></span>
<span class="r-in"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/sequential.html" class="external-link">sequential</a></span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

