<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Handling Time Series Lists • distantia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Handling Time Series Lists">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">distantia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/dynamic_time_warping_and_lock_step.html">Dynamic Time Warping vs Lock-Step</a></li>
    <li><a class="dropdown-item" href="../articles/time_series_lists.html">Handling Time Series Lists</a></li>
    <li><a class="dropdown-item" href="../articles/mapping_dissimilarity.html">Mapping Time Series Dissimilarity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Original Paper</h6></li>
    <li><a class="external-link dropdown-item" href="https://nsojournals.onlinelibrary.wiley.com/doi/full/10.1111/ecog.04895">Benito &amp; Birks 2020 (Ecography)</a></li>
    <li><a class="dropdown-item" href="../articles/distantia_in_the_wild.html">In The Wild</a></li>
    <li><a class="dropdown-item" href="../articles/dtw_applications.html">In The Wild</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BlasBenito/distantia/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Handling Time Series Lists</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BlasBenito/distantia/blob/main/vignettes/articles/time_series_lists.Rmd" class="external-link"><code>vignettes/articles/time_series_lists.Rmd</code></a></small>
      <div class="d-none name"><code>time_series_lists.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The R package <code>distantia</code> 2.0 introduces Time Series Lists
as obect to organize time series for dissimilarity analyses, and
provides a complete toolset to manage them.</p>
<p>This article describes Time Series Lists in detail, and showcases the
most common data handling procedures enabled by the new functions
included in the package.</p>
</div>
<div class="section level2">
<h2 id="introduction-to-time-series-lists">Introduction to Time Series Lists<a class="anchor" aria-label="anchor" href="#introduction-to-time-series-lists"></a>
</h2>
<p>In this new version of <code>distantia</code>, groups of time series
are organized as named lists of <a href="https://cran.r-project.org/web/packages/zoo/index.html" class="external-link">zoo</a>
objects. These lists are named <strong>Time Series Lists</strong> (TSL)
within the package, and are designed to facilitate the parallelization
of dissimilarity analyses.</p>
<p>TSL is not a class by choice, as the idea is keeping them as simple
as possible to grant users the autonomy to create or modify them as
needed.</p>
<div class="section level4">
<h4 id="zoo-time-series">Zoo Time Series<a class="anchor" aria-label="anchor" href="#zoo-time-series"></a>
</h4>
<p>The R package <code>zoo</code> provides an S3 class of the same name
designed to handle observations ordered by an index. It supports various
index classes, such as Date, POSIXct, or even custom numeric or
character indices, and handles regular and irregular time series equally
well.</p>
<p>Other advantages of using zoo objects include a seamless intergration
with base R methods, and built-in tools for alignment, merging, and
subsetting.</p>
<p>Let’s take a look at a little zoo object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://blasbenito.github.io/distantia/">distantia</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: doFuture</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loading required package: future</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_simulate.html">zoo_simulate</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"my_zoo"</span>,</span>
<span>  cols <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  rows <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"2024-01-01"</span>, </span>
<span>    <span class="st">"2024-12-31"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  na_fraction <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  irregular <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/zoo_plot.html">zoo_plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-2-1.png" width="750"></p>
<p>Zoo objects have two main components, a data matrix with the time
series observations, and an index representing time or sample order.</p>
<p>The data matrix is extracted with <code><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">zoo::coredata()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    a         b         c</span></span>
<span><span class="co">#&gt; 2024-01-01 0.2766156        NA 0.4311940</span></span>
<span><span class="co">#&gt; 2024-01-20 0.2757911 0.2576964 0.5035254</span></span>
<span><span class="co">#&gt; 2024-02-08 0.6195721 0.6088013 0.7032048</span></span>
<span><span class="co">#&gt; 2024-02-27 0.7287392 0.7720906 0.8115532</span></span>
<span><span class="co">#&gt; 2024-04-25 0.6145089 0.6955610 0.6016670</span></span>
<span><span class="co">#&gt; 2024-07-11 0.4504343 0.3641707 0.2375049</span></span>
<span><span class="co">#&gt; 2024-08-18        NA        NA 0.2669233</span></span>
<span><span class="co">#&gt; 2024-09-06 0.3662741 0.3615319 0.2490074</span></span>
<span><span class="co">#&gt; 2024-11-03 0.3074425 0.3016022 0.4022756</span></span>
<span><span class="co">#&gt; 2024-12-11 0.3435016 0.1728781 0.3047951</span></span>
<span><span class="co">#&gt; attr(,"name")</span></span>
<span><span class="co">#&gt; [1] "my_zoo"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "matrix" "array"</span></span></code></pre></div>
<p>The core data of a zoo object can also be a vector when the time
series is univariate.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/zoo.html" class="external-link">zoo</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>However, this is <strong>frowned upon</strong> in
<code>distantia</code>, and these vectors should always be converted to
matrices.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_vector_to_matrix.html">zoo_vector_to_matrix</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The index of zoo time series is extracted with
<code><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">zoo::index()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "2024-01-01" "2024-01-20" "2024-02-08" "2024-02-27" "2024-04-25"</span></span>
<span><span class="co">#&gt;  [6] "2024-07-11" "2024-08-18" "2024-09-06" "2024-11-03" "2024-12-11"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Date"</span></span></code></pre></div>
<p>The classes for zoo indices explicitly supported in
<code>distantia</code> are <code>Date</code>, <code>POSIXct</code>, and
<code>numeric</code>. The function <code><a href="../reference/zoo_time.html">distantia::zoo_time()</a></code>
helps summarize the time features of a zoo object, including the time
class.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_time.html">zoo_time</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt;     name rows class units   length resolution      begin        end</span></span>
<span><span class="co">#&gt; 1 my_zoo   10  Date  days 345.7895   38.42105 2024-01-01 2024-12-11</span></span>
<span><span class="co">#&gt;       keywords</span></span>
<span><span class="co">#&gt; 1 years, q....</span></span></code></pre></div>
<p>Additionally, in <code>distantia</code> all zoo objects are expected
to have the attribute <code>name</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="co">#&gt; [1] "my_zoo"</span></span></code></pre></div>
<p>This attribute, not part of the <code>zoo</code> class, is used to
facilitate plotting operations, and it is managed internally by
<code>tsl_...()</code> functions. There are several functions in
<code>distantia</code> to manage the names of zoo objects.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#reset zoo name</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_name_set.html">zoo_name_set</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">z</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"My_Zoo"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#get zoo name</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_name_get.html">zoo_name_get</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "My_Zoo"</span></span>
<span></span>
<span><span class="co">#clean zoo name</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_name_clean.html">zoo_name_clean</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">z</span>,</span>
<span>  lowercase <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_name_get.html">zoo_name_get</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "my_zoo"</span></span></code></pre></div>
<p>This package comes with several functions to manipulate zoo
objects:</p>
<ul>
<li>
<code><a href="../reference/zoo_name_set.html">zoo_name_set()</a></code>, <code><a href="../reference/zoo_name_get.html">zoo_name_get()</a></code> and
<code><a href="../reference/zoo_name_clean.html">zoo_name_clean()</a></code>: handle the attribute “name”.</li>
<li>
<code><a href="../reference/zoo_time.html">zoo_time()</a></code>: details of the zoo index.</li>
<li>
<code><a href="../reference/zoo_aggregate.html">zoo_aggregate()</a></code>: time aggregation of zoo objects.</li>
<li>
<code><a href="../reference/zoo_resample.html">zoo_resample()</a></code>: interpolation or extrapolation to a
different time, or from irregular to regular time.</li>
<li>
<code>zoo_smooth()</code>: rolling-window smoothing.</li>
<li>
<code><a href="../reference/zoo_permute.html">zoo_permute()</a></code>: restricted permutation.</li>
<li>
<code><a href="../reference/zoo_vector_to_matrix.html">zoo_vector_to_matrix()</a></code> and <code><a href="../reference/zoo_to_tsl.html">zoo_to_tsl()</a></code>:
internal functions to facilitate handling zoo objects within TSLs.</li>
</ul>
</div>
<div class="section level4">
<h4 id="time-series-lists-tsl">Time Series Lists (TSL)<a class="anchor" aria-label="anchor" href="#time-series-lists-tsl"></a>
</h4>
<p>TSLs are <em>named</em> lists of zoo time series. The example below
shows how to build a TSL from scratch with zoo objects. But this is not
the most common or comfortable case, so please, visit the section
<strong>Creating Time Series Lists</strong> to find out how to convert
your data easily to TSL.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#create simple tsl</span></span>
<span><span class="va">my_tsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  A <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_simulate.html">zoo_simulate</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    na_fraction <span class="op">=</span> <span class="fl">0.2</span></span>
<span>  <span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/zoo_simulate.html">zoo_simulate</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">my_tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "A" "B"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">my_tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span>
<span></span>
<span><span class="co">#names of the zoo objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">my_tsl</span>, FUN <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/zoo_name_get.html">zoo_name_get</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; $A</span></span>
<span><span class="co">#&gt; [1] "A"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $B</span></span>
<span><span class="co">#&gt; [1] "A"</span></span>
<span></span>
<span><span class="co">#class of the objects within the list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">my_tsl</span>, FUN <span class="op">=</span> <span class="va">class</span><span class="op">)</span></span>
<span><span class="co">#&gt; $A</span></span>
<span><span class="co">#&gt; [1] "zoo"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $B</span></span>
<span><span class="co">#&gt; [1] "zoo"</span></span></code></pre></div>
<p>TSLs ready for dissimilarity analyses <strong>must follow several
rules</strong> to ensure that dissimilarity analyses run without
issues:</p>
<ul>
<li>The elements of the list or the zoo objects must be named.</li>
<li>Time series names cannot be duplicated.</li>
<li>The coredata of all zoo objects must be of class
<code>matrix</code>.</li>
<li>There cannot be NA, Inf, or NaN in the zoo objects.</li>
<li>All zoo columns must be named.</li>
<li>All zoo columns must be numeric.</li>
<li>All zoo objects within the TSL must share at least one column
name.</li>
<li>The index of the zoo objects must be of the same class.</li>
</ul>
<p>I understand these are way too many rules, but the functions
<code><a href="../reference/tsl_diagnose.html">tsl_diagnose()</a></code> and <code><a href="../reference/tsl_repair.html">tsl_repair()</a></code> are there to
help you forget about them. When applying <code><a href="../reference/tsl_diagnose.html">tsl_diagnose()</a></code> to
<code>my_tsl</code> we can see it has several issues.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_diagnose.html">tsl_diagnose</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">my_tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; distantia::tsl_diagnose(): issues in TSL structure:</span></span>
<span><span class="co">#&gt; ---------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - list and time series names must match and be unique: reset names with distantia::tsl_names_set().</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; distantia::tsl_diagnose(): issues in TSL values:</span></span>
<span><span class="co">#&gt; --------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - there are NA, Inf, -Inf, or NaN cases in the time series: interpolate or remove them with distantia::tsl_handle_NA().</span></span></code></pre></div>
<p>From there, we can either follow the suggestions, or apply
<code><a href="../reference/tsl_repair.html">tsl_repair()</a></code> directly, as done below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_repair.html">tsl_repair</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">my_tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; distantia::tsl_repair(): repairs in TSL structure:</span></span>
<span><span class="co">#&gt; --------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - fixed naming issues.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - removed exclusive columns not shared across time series.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; distantia::tsl_repair(): repairs in TSL values:</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - interpolated NA cases in zoo objects with distantia::tsl_handle_NA().</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>This function identifies the issues raised up by
<code><a href="../reference/tsl_diagnose.html">tsl_diagnose()</a></code> and repairs them when possible. If
<code><a href="../reference/tsl_diagnose.html">tsl_diagnose()</a></code> is run again, it should stay silent if
everything is ok.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_diagnose.html">tsl_diagnose</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">my_tsl</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>From this point, our TSL is ready to go!</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">my_tsl</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-15-1.png" width="750"></p>
</div>
</div>
<div class="section level2">
<h2 id="creating-tsls">Creating TSLs<a class="anchor" aria-label="anchor" href="#creating-tsls"></a>
</h2>
<p>The function <code><a href="../reference/tsl_initialize.html">tsl_initialize()</a></code> (with the alias
<code><a href="../reference/tsl_initialize.html">tsl_init()</a></code>) is designed to help transform several data
structures to Time Series List.</p>
<div class="section level4">
<h4 id="long-data-frame-to-tsl">Long Data Frame to TSL<a class="anchor" aria-label="anchor" href="#long-data-frame-to-tsl"></a>
</h4>
<p>Long and tidy data frames are convenient structures to store
multivariate time series of a reasonable size. For example, the data
frame <code>fagus_dynamics</code> shown below has the column “name”
identifying separate time series, the column “time” with observation
dates, and three numeric columns with environmental observations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fagus_dynamics</span><span class="op">)</span></span>
<span><span class="co">#&gt;    name       time    evi rainfall temperature</span></span>
<span><span class="co">#&gt; 1 Spain 2001-01-01 0.1929    199.8         8.1</span></span>
<span><span class="co">#&gt; 5 Spain 2001-02-01 0.2423     50.6         7.8</span></span>
<span><span class="co">#&gt; 6 Spain 2001-03-01 0.2761    170.9        11.0</span></span>
<span><span class="co">#&gt; 7 Spain 2001-04-01 0.3961     62.7        10.4</span></span>
<span><span class="co">#&gt; 8 Spain 2001-05-01 0.4445     52.7        14.1</span></span>
<span><span class="co">#&gt; 9 Spain 2001-06-01 0.6434     23.1        17.6</span></span></code></pre></div>
<p>Transforming this data frame to TSL is quite straightforward:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_initialize</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">fagus_dynamics</span>,</span>
<span>  name_column <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  time_column <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#even shorter!</span></span>
<span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_init</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">fagus_dynamics</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl  <span class="op">=</span> <span class="va">tsl</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-18-1.png" width="750"></p>
<p>Once manipulated and/or analyzed, a TSL can be converted back to data
frame with <code><a href="../reference/tsl_to_df.html">tsl_to_df()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_to_df.html">tsl_to_df</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;      name       time    evi rainfall temperature</span></span>
<span><span class="co">#&gt; 1 Germany 2001-01-01 0.3539     68.6         2.1</span></span>
<span><span class="co">#&gt; 2 Germany 2001-02-01 0.2940     56.6         3.8</span></span>
<span><span class="co">#&gt; 3 Germany 2001-03-01 0.3453    128.2         6.8</span></span>
<span><span class="co">#&gt; 4 Germany 2001-04-01 0.3924     82.5         8.2</span></span>
<span><span class="co">#&gt; 5 Germany 2001-05-01 0.6880     32.7        15.9</span></span>
<span><span class="co">#&gt; 6 Germany 2001-06-01 0.6837     70.8        16.0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="wide-data-frame-to-tsl">Wide Data Frame to TSL<a class="anchor" aria-label="anchor" href="#wide-data-frame-to-tsl"></a>
</h4>
<p>A wide data frame is a useful structure to store univariate time
series observed in different places at the same times.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">evi_wide</span><span class="op">)</span></span>
<span><span class="co">#&gt;         time evi_Spain evi_Germany evi_Sweden</span></span>
<span><span class="co">#&gt; 1 2001-01-01    0.1929      0.3539     0.1827</span></span>
<span><span class="co">#&gt; 5 2001-02-01    0.2423      0.2940     0.1819</span></span>
<span><span class="co">#&gt; 6 2001-03-01    0.2761      0.3453     0.2155</span></span>
<span><span class="co">#&gt; 7 2001-04-01    0.3961      0.3924     0.2369</span></span>
<span><span class="co">#&gt; 8 2001-05-01    0.4445      0.6880     0.5192</span></span>
<span><span class="co">#&gt; 9 2001-06-01    0.6434      0.6837     0.5917</span></span></code></pre></div>
<p>When no <code>name_column</code> is provided,
<code><a href="../reference/tsl_initialize.html">tsl_initialize()</a></code> assumes that each column is a univariate
time series.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_initialize</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">evi_wide</span>,</span>
<span>  time_column <span class="op">=</span> <span class="st">"time"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-23-1.png" width="750"></p>
<p>In this case, the column names of the univariate zoo objects will
“x”.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_get.html">tsl_colnames_get</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; $evi_Spain</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evi_Germany</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evi_Sweden</span></span>
<span><span class="co">#&gt; [1] "x"</span></span></code></pre></div>
<p>This name can be reset as needed with
<code><a href="../reference/tsl_colnames_set.html">tsl_colnames_set()</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_set.html">tsl_colnames_set</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  names <span class="op">=</span> <span class="st">"evi"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_get.html">tsl_colnames_get</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; $evi_Spain</span></span>
<span><span class="co">#&gt; [1] "evi"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evi_Germany</span></span>
<span><span class="co">#&gt; [1] "evi"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evi_Sweden</span></span>
<span><span class="co">#&gt; [1] "evi"</span></span></code></pre></div>
<p>This TSL can be converted to data frame, but this time the result is
a long data frame.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_to_df.html">tsl_to_df</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;        name       time    evi</span></span>
<span><span class="co">#&gt; 1 evi_Spain 2001-01-01 0.1929</span></span>
<span><span class="co">#&gt; 2 evi_Spain 2001-02-01 0.2423</span></span>
<span><span class="co">#&gt; 3 evi_Spain 2001-03-01 0.2761</span></span>
<span><span class="co">#&gt; 4 evi_Spain 2001-04-01 0.3961</span></span>
<span><span class="co">#&gt; 5 evi_Spain 2001-05-01 0.4445</span></span>
<span><span class="co">#&gt; 6 evi_Spain 2001-06-01 0.6434</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="vectors-and-matrices-to-tsl">Vectors and Matrices to TSL<a class="anchor" aria-label="anchor" href="#vectors-and-matrices-to-tsl"></a>
</h4>
<p>A list of numeric vectors can also be converted to TSL. In this case,
the zoo index is a sequence of integers.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_initialize</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-28-1.png" width="750"></p>
<p>The same thing can be done with matrices as well.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_initialize</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,</span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-29-1.png" width="750"></p>
</div>
</div>
<div class="section level2">
<h2 id="the-tsl-toolset">The TSL Toolset<a class="anchor" aria-label="anchor" href="#the-tsl-toolset"></a>
</h2>
<p>The functions in <code>distantia</code> to handle TSLs are named
after the pattern <code>tsl_...()</code>. Some of these functions are
designed to explore and better understand your TSLs, while others are
designed to manipulate and transform them to facilitate dissimilarity
analyses.</p>
<p>This section offers a complete overview of these functions and their
applications.</p>
<div class="section level4">
<h4 id="parallelization-setup">Parallelization Setup<a class="anchor" aria-label="anchor" href="#parallelization-setup"></a>
</h4>
<p>The functions to manage TSLs <strong>are a bunch of
<code>lapply</code> in a trench coat</strong>. Most use
<code><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future.apply::future_lapply()</a></code>, a parallelized version of
<code>lapply</code> from the <code>future.apply</code> package, and a
few combine <code><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach::foreach()</a></code> with
<code>doFuture::%iterator%</code> in shameless parallelized loops.</p>
<p>As such, they all support a parallelization backend provided by the
<code>future</code> package, as shown below. However, take in mind that
parallelization is only worth it for very large datasets.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://parallelly.futureverse.org" class="external-link">parallelly</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span></span>
<span>  <span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span>,</span>
<span>  workers <span class="op">=</span> <span class="fu">parallelly</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>They also support progress bars via the <a href="https://progressr.futureverse.org/" class="external-link"><code>progressr</code></a>
package. However, this option, commented in the code below, does not
work in Rmarkdown.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#progress bar (does not work in Rmarkdown)</span></span>
<span><span class="co">#progressr::handlers(global = TRUE)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="explore-tsls">Explore TSLs<a class="anchor" aria-label="anchor" href="#explore-tsls"></a>
</h4>
<p>This section showcases all tools available in <code>distantia</code>
to better understand our Time Series Lists. Logically, the section
starts with <code><a href="../reference/tsl_simulate.html">distantia::tsl_simulate()</a></code>, a function that has
nothing to do with such purpose.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_simulate.html">tsl_simulate</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  cols <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  rows <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  time_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2010-01-01"</span>, <span class="st">"2020-01-01"</span><span class="op">)</span>,</span>
<span>  data_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  seasons <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  na_fraction <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  irregular <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-33-1.png" width="750"></p>
<p>The simpler tools to explore TSLs are focused on simpler things, like
extracting TSL names and dimensions.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#time series names</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_names_get.html">tsl_names_get</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A   B   C   D </span></span>
<span><span class="co">#&gt; "A" "B" "C" "D"</span></span>
<span></span>
<span><span class="co">#column names</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_get.html">tsl_colnames_get</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; $A</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c" "d" "e"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $B</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c" "d" "e"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $C</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c" "d" "e"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $D</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c" "d" "e"</span></span>
<span></span>
<span><span class="co">#number of columns</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_ncol.html">tsl_ncol</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; $A</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $B</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $C</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $D</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="co">#number of rows</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_nrow.html">tsl_nrow</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; $A</span></span>
<span><span class="co">#&gt; [1] 895</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $B</span></span>
<span><span class="co">#&gt; [1] 828</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $C</span></span>
<span><span class="co">#&gt; [1] 948</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $D</span></span>
<span><span class="co">#&gt; [1] 755</span></span></code></pre></div>
<p>The function <code><a href="../reference/tsl_time.html">tsl_time()</a></code> summarizes the time features of
all time series in a TSL.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_time.html">tsl_time</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt;   name rows class units   length resolution      begin        end     keywords</span></span>
<span><span class="co">#&gt; 1    A  895  Date  days 3624.449   4.054194 2010-01-15 2019-12-18 years, q....</span></span>
<span><span class="co">#&gt; 2    B  828  Date  days 3646.485   4.409293 2010-01-02 2019-12-27 decades,....</span></span>
<span><span class="co">#&gt; 3    C  948  Date  days 3638.513   3.842147 2010-01-05 2019-12-23 years, q....</span></span>
<span><span class="co">#&gt; 4    D  755  Date  days 3643.532   4.832271 2010-01-04 2019-12-27 years, q....</span></span></code></pre></div>
<p>The function <code><a href="../reference/tsl_stats.html">tsl_stats()</a></code>, on the other hand, computes
stats by time series and variable to summarize the TSL values.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_stats</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>, </span>
<span>  lags <span class="op">=</span> <span class="fl">1</span> <span class="co">#temporal autocorrelation lag</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_stats</span></span>
<span><span class="co">#&gt;    name variable NA_count        min        q1    median        q3       max</span></span>
<span><span class="co">#&gt; 1     A        a       95 0.09800680 0.2854132 0.3849914 0.5370719 0.7674207</span></span>
<span><span class="co">#&gt; 2     B        a       79 0.13872269 0.3007013 0.3942495 0.4940126 0.6487662</span></span>
<span><span class="co">#&gt; 3     C        a      109 0.27719376 0.4101711 0.4665759 0.5036950 0.6624000</span></span>
<span><span class="co">#&gt; 4     D        a       84 0.10229087 0.3040870 0.3835407 0.4393233 0.6986380</span></span>
<span><span class="co">#&gt; 5     A        b       92 0.18770587 0.4184237 0.5425625 0.7183262 0.9493957</span></span>
<span><span class="co">#&gt; 6     B        b       91 0.17210765 0.3897937 0.5482020 0.6652081 0.8337273</span></span>
<span><span class="co">#&gt; 7     C        b       82 0.18745969 0.4215132 0.5207325 0.5916581 0.8933747</span></span>
<span><span class="co">#&gt; 8     D        b       74 0.27306583 0.4311374 0.4926373 0.5442130 0.6738263</span></span>
<span><span class="co">#&gt; 9     A        c       86 0.27818993 0.3897210 0.5338184 0.6072574 0.6982036</span></span>
<span><span class="co">#&gt; 10    B        c       72 0.20903477 0.3370288 0.5106152 0.5814762 0.6790678</span></span>
<span><span class="co">#&gt; 11    C        c       84 0.24096347 0.3557717 0.5255553 0.6063718 0.7548251</span></span>
<span><span class="co">#&gt; 12    D        c       86 0.26436389 0.3780786 0.4232056 0.5317723 0.7708494</span></span>
<span><span class="co">#&gt; 13    A        d       74 0.09104849 0.2030033 0.3816940 0.5920768 0.8119424</span></span>
<span><span class="co">#&gt; 14    B        d       81 0.14081870 0.2190328 0.3864535 0.5775882 0.7702173</span></span>
<span><span class="co">#&gt; 15    C        d       93 0.14189279 0.3069329 0.3949073 0.4852792 0.6477854</span></span>
<span><span class="co">#&gt; 16    D        d       58 0.07457297 0.2129388 0.3626525 0.5392032 0.7086870</span></span>
<span><span class="co">#&gt; 17    A        e      100 0.09011920 0.4445964 0.5367143 0.6687842 0.8646269</span></span>
<span><span class="co">#&gt; 18    B        e       91 0.15213822 0.4179866 0.4870679 0.6072825 0.7692504</span></span>
<span><span class="co">#&gt; 19    C        e      106 0.20399463 0.3968680 0.4878493 0.5956665 0.7596875</span></span>
<span><span class="co">#&gt; 20    D        e       75 0.08108168 0.3135596 0.3926041 0.5660621 0.7388785</span></span>
<span><span class="co">#&gt;         mean         sd     range   iq_range     skewness   kurtosis  ac_lag_1</span></span>
<span><span class="co">#&gt; 1  0.4044377 0.15283312 0.6694139 0.25165869  0.135796703 -1.1614189 0.9923180</span></span>
<span><span class="co">#&gt; 2  0.3928407 0.12114009 0.5100435 0.19331131 -0.053857813 -1.1259414 0.9907480</span></span>
<span><span class="co">#&gt; 3  0.4597313 0.07042273 0.3852063 0.09352395  0.005461071 -0.4426902 0.9925611</span></span>
<span><span class="co">#&gt; 4  0.3795733 0.11119890 0.5963471 0.13523637  0.300669286  0.2207331 0.9857942</span></span>
<span><span class="co">#&gt; 5  0.5589036 0.18735525 0.7616898 0.29990253  0.009134059 -1.2069282 0.9956180</span></span>
<span><span class="co">#&gt; 6  0.5299596 0.16545720 0.6616196 0.27541447 -0.175211756 -1.2978824 0.9963093</span></span>
<span><span class="co">#&gt; 7  0.5136854 0.14010779 0.7059150 0.17014492  0.169843739 -0.5512491 0.9962088</span></span>
<span><span class="co">#&gt; 8  0.4833612 0.08858408 0.4007605 0.11307562 -0.404070295 -0.5451592 0.9947963</span></span>
<span><span class="co">#&gt; 9  0.5011489 0.11874399 0.4200137 0.21753637 -0.089411492 -1.6131048 0.9967500</span></span>
<span><span class="co">#&gt; 10 0.4623944 0.13293121 0.4700330 0.24444742 -0.216507414 -1.5854223 0.9975072</span></span>
<span><span class="co">#&gt; 11 0.4942972 0.13852011 0.5138616 0.25060008 -0.068798985 -1.4743774 0.9969533</span></span>
<span><span class="co">#&gt; 12 0.4593613 0.11521512 0.5064855 0.15369375  0.793200483 -0.3362831 0.9952735</span></span>
<span><span class="co">#&gt; 13 0.4019948 0.20923281 0.7208939 0.38907341  0.294977793 -1.4117867 0.9971173</span></span>
<span><span class="co">#&gt; 14 0.4008981 0.18935485 0.6293986 0.35855547  0.248743033 -1.5865958 0.9975460</span></span>
<span><span class="co">#&gt; 15 0.3961837 0.11144364 0.5058926 0.17834624  0.031279206 -0.9949715 0.9961713</span></span>
<span><span class="co">#&gt; 16 0.3773762 0.17764114 0.6341141 0.32626441  0.155830203 -1.4716906 0.9955135</span></span>
<span><span class="co">#&gt; 17 0.5404382 0.15653877 0.7745077 0.22418779 -0.086928464 -0.7879823 0.9936674</span></span>
<span><span class="co">#&gt; 18 0.5047805 0.12378891 0.6171122 0.18929582  0.023233593 -0.9391389 0.9928874</span></span>
<span><span class="co">#&gt; 19 0.4924585 0.12809646 0.5556929 0.19879847  0.138175689 -1.0669619 0.9964616</span></span>
<span><span class="co">#&gt; 20 0.4213054 0.15606866 0.6577968 0.25250251  0.064335980 -1.0802679 0.9962414</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="handle-na-cases">Handle NA Cases<a class="anchor" aria-label="anchor" href="#handle-na-cases"></a>
</h4>
<p>The dissimilarity analyses implemented in version 2.0 of
<code>distantia</code> <strong>do not support NA cases</strong> in time
series lists. There are two alternate workflows to handle NA cases in
time series list.</p>
<p>The first uses <code><a href="../reference/tsl_count_NA.html">tsl_count_NA()</a></code> and
<code><a href="../reference/tsl_handle_NA.html">tsl_handle_NA()</a></code>. The former function converts Inf and NaN
to NA and counts NA cases in each time series, while the latter either
omits or imputes NA cases via <code><a href="https://rdrr.io/pkg/zoo/man/na.approx.html" class="external-link">zoo::na.approx()</a></code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#count NA</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_count_NA.html">tsl_count_NA</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span> </span>
<span><span class="co">#&gt; $A</span></span>
<span><span class="co">#&gt; [1] 447</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $B</span></span>
<span><span class="co">#&gt; [1] 414</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $C</span></span>
<span><span class="co">#&gt; [1] 474</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $D</span></span>
<span><span class="co">#&gt; [1] 377</span></span>
<span></span>
<span><span class="co">#impute NA cases</span></span>
<span><span class="va">tsl_notNA</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_handle_NA.html">tsl_handle_NA</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  na_action <span class="op">=</span> <span class="st">"impute"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#re-count</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_count_NA.html">tsl_count_NA</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl_notNA</span><span class="op">)</span> </span>
<span><span class="co">#&gt; $A</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $B</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $C</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $D</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>The second workflow involves the functions
<code><a href="../reference/tsl_diagnose.html">tsl_diagnose()</a></code> and <code><a href="../reference/tsl_repair.html">tsl_repair()</a></code>, is more
general because it addresses other potential issues at once.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#diagnose issues with NA values</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_diagnose.html">tsl_diagnose</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; distantia::tsl_diagnose(): issues in TSL values:</span></span>
<span><span class="co">#&gt; --------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - there are NA, Inf, -Inf, or NaN cases in the time series: interpolate or remove them with distantia::tsl_handle_NA().</span></span>
<span></span>
<span><span class="co">#impute NA cases</span></span>
<span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_repair.html">tsl_repair</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; distantia::tsl_repair(): repairs in TSL values:</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   - interpolated NA cases in zoo objects with distantia::tsl_handle_NA().</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="co">#re-diagnose to check result</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_diagnose.html">tsl_diagnose</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="subsetting">Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h4>
<p>The function <code><a href="../reference/tsl_subset.html">tsl_subset()</a></code> helps focus on particular
<em>regions</em> of a time series list. Additionally, by default this
function returns the numeric columns that are shared across all time
series in a TSL.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_new</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>,</span>
<span>  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2014-01-01"</span>, <span class="st">"2018-01-01"</span><span class="op">)</span>,</span>
<span>  numeric_cols <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  shared_cols <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_new</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-39-1.png" width="750"></p>
<p>The function <code><a href="../reference/tsl_burst.html">tsl_burst()</a></code> transforms a multivariate TSL
into a univariate TSL by creating a new zoo object from each column of
the original zoo objects. This function helps apply dissimilarity
analysis between individual variables in multivariate time series.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#burst multivariate time series to univariate</span></span>
<span><span class="va">tsl_univariate</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_burst.html">tsl_burst</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_new</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#check new time series names</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_names_get.html">tsl_names_get</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl_univariate</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A__a   A__b   C__a   C__b   D__a   D__b </span></span>
<span><span class="co">#&gt; "A__a" "A__b" "C__a" "C__b" "D__a" "D__b"</span></span>
<span></span>
<span><span class="co">#check new column names</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_get.html">tsl_colnames_get</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl_univariate</span><span class="op">)</span></span>
<span><span class="co">#&gt; $A__a</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $A__b</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $C__a</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $C__b</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $D__a</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $D__b</span></span>
<span><span class="co">#&gt; [1] "x"</span></span>
<span></span>
<span><span class="co">#plot univariate time series</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_univariate</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-40-1.png" width="750"></p>
</div>
<div class="section level4">
<h4 id="aggregation">Aggregation<a class="anchor" aria-label="anchor" href="#aggregation"></a>
</h4>
<p>Aggregation reduces time series frequency (a.k.a
<strong>downsampling</strong>) by summarizing multiple data points into
a single value over a specified time interval. It results in a reduction
in the number of samples, smooths noise out, can transform irregular
time series into regular, and can generate entirely new time series
depending on the aggregation stats. On the other hand, it obscures fine
grain detail and alters statistical properties such as variance and
temporal autocorrelation.</p>
<p>In <code>distantia</code>, this operation is supported by the
function <code><a href="../reference/tsl_aggregate.html">tsl_aggregate()</a></code>, with two arguments:</p>
<ul>
<li>
<code>new_time</code>: time vector or keyword defining time
intervals to aggregate over.</li>
<li>
<code>f</code>: aggregation function summarizing observations over
aggregation time intervals.</li>
</ul>
<p>The code below illustrates this function’s usage to compute yearly
temperature and precipitation indicators from the monthly observations
in the dataset <code>honeycomb_climate</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_init</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/honeycomb_climate.html">honeycomb_climate</a></span>,</span>
<span>  name <span class="op">=</span> <span class="st">"cell"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>    names <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="co">#subset first five elements</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-42-1.png" width="750"></p>
<p>The easiest way to define aggregation intervals in
<code>distantia</code> is to use a keyword. The function
<code><a href="../reference/tsl_time.html">tsl_time()</a></code> returns the supported keywords for a given
TSL.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_time</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_time.html">tsl_time</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  keywords <span class="op">=</span> <span class="st">"aggregate"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df_time</span><span class="op">$</span><span class="va">keywords</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "decades"  "years"    "quarters"</span></span></code></pre></div>
<p>Let’s focus on “quarters” for the rest of the example.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interval</span> <span class="op">&lt;-</span> <span class="st">"quarters"</span></span></code></pre></div>
<p>The code below subsets the column “temperature” in <code>tsl</code>,
aggregates by computing the minimum, maximum, and mean per quarter, and
adds a suffix to each new aggregated column.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subset temperature column</span></span>
<span><span class="va">tsl_temperature</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  colnames <span class="op">=</span> <span class="st">"temperature"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#compute stats: minimum, maximum, and mean</span></span>
<span><span class="va">tsl_temperature_min</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_aggregate.html">tsl_aggregate</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_temperature</span>,</span>
<span>  new_time <span class="op">=</span> <span class="va">interval</span>,</span>
<span>  f <span class="op">=</span> <span class="va">min</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_suffix.html">tsl_colnames_suffix</a></span><span class="op">(</span></span>
<span>    suffix <span class="op">=</span> <span class="st">"_min"</span> <span class="co">#set suffix for aggregated column</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tsl_temperature_max</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_aggregate.html">tsl_aggregate</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_temperature</span>,</span>
<span>  new_time <span class="op">=</span> <span class="va">interval</span>,</span>
<span>  f <span class="op">=</span> <span class="va">max</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_suffix.html">tsl_colnames_suffix</a></span><span class="op">(</span></span>
<span>    suffix <span class="op">=</span> <span class="st">"_max"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tsl_temperature_mean</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_aggregate.html">tsl_aggregate</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_temperature</span>,</span>
<span>  new_time <span class="op">=</span> <span class="va">interval</span>,</span>
<span>  f <span class="op">=</span> <span class="va">mean</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_suffix.html">tsl_colnames_suffix</a></span><span class="op">(</span></span>
<span>    suffix <span class="op">=</span> <span class="st">"_mean"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Similar steps can be followed to process the variable
“precipitation”.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subset temperature column</span></span>
<span><span class="va">tsl_precipitation</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  colnames <span class="op">=</span> <span class="st">"precipitation"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#compute stats: minimum, maximum, and mean</span></span>
<span><span class="va">tsl_precipitation_sum</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_aggregate.html">tsl_aggregate</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_precipitation</span>,</span>
<span>  new_time <span class="op">=</span> <span class="va">interval</span>,</span>
<span>  f <span class="op">=</span> <span class="va">sum</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_suffix.html">tsl_colnames_suffix</a></span><span class="op">(</span></span>
<span>    suffix <span class="op">=</span> <span class="st">"_sum"</span> <span class="co">#set suffix for aggregated column</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tsl_precipitation_max</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_aggregate.html">tsl_aggregate</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_precipitation</span>,</span>
<span>  new_time <span class="op">=</span> <span class="va">interval</span>,</span>
<span>  f <span class="op">=</span> <span class="va">max</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_suffix.html">tsl_colnames_suffix</a></span><span class="op">(</span></span>
<span>    suffix <span class="op">=</span> <span class="st">"_max"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tsl_precipitation_min</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_aggregate.html">tsl_aggregate</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_precipitation</span>,</span>
<span>  new_time <span class="op">=</span> <span class="va">interval</span>,</span>
<span>  f <span class="op">=</span> <span class="va">min</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_colnames_suffix.html">tsl_colnames_suffix</a></span><span class="op">(</span></span>
<span>    suffix <span class="op">=</span> <span class="st">"_min"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Finally, we join all new TSLs together to examine the result.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_climate_stats</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_join.html">tsl_join</a></span><span class="op">(</span></span>
<span>  <span class="va">tsl_temperature_min</span>,</span>
<span>  <span class="va">tsl_temperature_max</span>,</span>
<span>  <span class="va">tsl_temperature_mean</span>,</span>
<span>  <span class="va">tsl_precipitation_sum</span>,</span>
<span>  <span class="va">tsl_precipitation_max</span>,</span>
<span>  <span class="va">tsl_precipitation_min</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_climate_stats</span>,</span>
<span>  ylim <span class="op">=</span> <span class="st">"relative"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-47-1.png" width="750"></p>
</div>
<div class="section level4">
<h4 id="resampling">Resampling<a class="anchor" aria-label="anchor" href="#resampling"></a>
</h4>
<p>Resampling is a model-based method to change the frequency of a time
series via interpolation. It is useful to align time series that are
irregular or have different resolutions. It is important to take in mind
that resampling to a frequency much higher than the original will
definitely result in interpolation artifacts and distorted time
series.</p>
<p>The code below creates two irregular time series with different
number of rows.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_init</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    A <span class="op">=</span> <span class="fu"><a href="../reference/zoo_simulate.html">zoo_simulate</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fl">100</span>, seasons <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    B <span class="op">=</span> <span class="fu"><a href="../reference/zoo_simulate.html">zoo_simulate</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fl">50</span>, seasons <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>, </span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-49-1.png" width="750"></p>
<p>The time features of this TSL show clear differences in frequency
between these time series.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_time.html">tsl_time</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl</span><span class="op">)</span><span class="op">[</span></span>
<span>  , </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"rows"</span>, <span class="st">"resolution"</span>, <span class="st">"begin"</span>, <span class="st">"end"</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span><span class="co">#&gt;   name rows resolution      begin        end</span></span>
<span><span class="co">#&gt; 1    A  100   36.70352 2010-01-01 2019-12-13</span></span>
<span><span class="co">#&gt; 2    B   50   74.53061 2010-01-01 2020-01-01</span></span></code></pre></div>
<p>By default, if the argument <code>new_time</code> is omitted, a
linear model (computed via <code>zoo:::na.approx()</code>) is used to
resample the TSL to its average resolution over the intersection of all
its time ranges.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_resampled</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_resample.html">tsl_resample</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_time.html">tsl_time</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl_resampled</span><span class="op">)</span><span class="op">[</span></span>
<span>  , </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"rows"</span>, <span class="st">"resolution"</span>, <span class="st">"begin"</span>, <span class="st">"end"</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span><span class="co">#&gt;   name rows resolution      begin        end</span></span>
<span><span class="co">#&gt; 1    A   75   49.10335 2010-01-01 2019-12-13</span></span>
<span><span class="co">#&gt; 2    B   75   49.10335 2010-01-01 2019-12-13</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_resampled</span>, </span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-51-1.png" width="750"></p>
<p>Otherwise, a keyword can be used to define the resampling frequency.
Again, we can find valid keywords using <code><a href="../reference/tsl_time.html">tsl_time()</a></code>, but
replacing “aggregate” with “resample” in the argument
<code>keywords</code>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_time.html">tsl_time</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  keywords <span class="op">=</span> <span class="st">"resample"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">keywords</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "years"    "quarters" "months"   "weeks"</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_resampled</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_resample.html">tsl_resample</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  new_time <span class="op">=</span> <span class="st">"weeks"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"loess"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: distantia::zoo_resample(): The time intervals of 'new_time' and 'x'</span></span>
<span><span class="co">#&gt; differ in one order of magnitude or more. The output time series might be</span></span>
<span><span class="co">#&gt; highly distorted.</span></span>
<span><span class="co">#&gt; Warning: UNRELIABLE VALUE: One of the 'future.apply' iterations</span></span>
<span><span class="co">#&gt; ('future_lapply-1') unexpectedly generated random numbers without declaring so.</span></span>
<span><span class="co">#&gt; There is a risk that those random numbers are not statistically sound and the</span></span>
<span><span class="co">#&gt; overall results might be invalid. To fix this, specify 'future.seed=TRUE'. This</span></span>
<span><span class="co">#&gt; ensures that proper, parallel-safe random numbers are produced via the</span></span>
<span><span class="co">#&gt; L'Ecuyer-CMRG method. To disable this check, use 'future.seed = NULL', or set</span></span>
<span><span class="co">#&gt; option 'future.rng.onMisuse' to "ignore".</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsl_time.html">tsl_time</a></span><span class="op">(</span>tsl <span class="op">=</span> <span class="va">tsl_resampled</span><span class="op">)</span><span class="op">[</span></span>
<span>  , </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"rows"</span>, <span class="st">"resolution"</span>, <span class="st">"begin"</span>, <span class="st">"end"</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span><span class="co">#&gt;   name rows resolution      begin        end</span></span>
<span><span class="co">#&gt; 1    A  519          7 2010-01-03 2019-12-08</span></span>
<span><span class="co">#&gt; 2    B  522          7 2010-01-03 2019-12-29</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_resampled</span>, </span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-53-1.png" width="750"></p>
</div>
<div class="section level4">
<h4 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h4>
<p>Time series smoothing is used to mitigate noise in high-frequency
time series, or to highlight general trends rather than fine-grain
details.</p>
<p>The function <code><a href="../reference/tsl_smooth.html">tsl_smooth()</a></code> implements two smoothing
methods: rolling-window and exponential.</p>
<p>To check how these methods work we first need a long and noisy
TSL.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_simulate.html">tsl_simulate</a></span><span class="op">(</span></span>
<span>  rows <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  irregular <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-55-1.png" width="750"></p>
<div class="section level5">
<h5 id="rolling-window-smoothing">Rolling-Window Smoothing<a class="anchor" aria-label="anchor" href="#rolling-window-smoothing"></a>
</h5>
<p>This method computes a statistic over a fixed-width window of
consecutive cases and replaces each central value with the computed
statistic. It should not be applied to highly irregular time series, as
it ignores time distance.</p>
<p>The code below applies this method with two different window
sizes.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#smoothing with window 100</span></span>
<span><span class="va">tsl_smooth_100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_smooth.html">tsl_smooth</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  window <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  f <span class="op">=</span> <span class="va">mean</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_smooth_100</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#smoothing with window 10</span></span>
<span><span class="va">tsl_smooth_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_smooth.html">tsl_smooth</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  window <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  f <span class="op">=</span> <span class="va">mean</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_smooth_10</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-56-1.png" width="750"><img src="time_series_lists_files/figure-html/unnamed-chunk-56-2.png" width="750">
The window size determines the smoothing scale, and with that, the type
of trend highlighted in the smoothing results.</p>
</div>
<div class="section level5">
<h5 id="exponential-smoothing">Exponential Smoothing<a class="anchor" aria-label="anchor" href="#exponential-smoothing"></a>
</h5>
<p>This method generates each new value as the weighted average of the
current value and past smoothed values. This weight is defined by the
argument <code>alpha</code> in <code><a href="../reference/tsl_smooth.html">tsl_smooth()</a></code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#smoothing with alpha 0.2</span></span>
<span><span class="va">tsl_smooth_exp_0.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_smooth.html">tsl_smooth</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_smooth_exp_0.2</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#smoothing with alpha 0.8</span></span>
<span><span class="va">tsl_smooth_exp_0.8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_smooth.html">tsl_smooth</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_smooth_exp_0.8</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-57-1.png" width="750"><img src="time_series_lists_files/figure-html/unnamed-chunk-57-2.png" width="750">
Alpha values closer to zero produce smoother results, as the plots above
show.</p>
</div>
</div>
<div class="section level4">
<h4 id="transformations">Transformations<a class="anchor" aria-label="anchor" href="#transformations"></a>
</h4>
<p>The function <code><a href="../reference/tsl_transform.html">tsl_transform()</a></code> applies a function
<code>f</code> to transform the values of a TSL. The names of the
available <code>f</code> functions can be listed with
<code><a href="../reference/f_list.html">f_list()</a></code>.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/f_list.html">f_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "f_binary"             "f_clr"                "f_detrend_difference"</span></span>
<span><span class="co">#&gt;  [4] "f_detrend_linear"     "f_detrend_poly"       "f_hellinger"         </span></span>
<span><span class="co">#&gt;  [7] "f_log"                "f_percent"            "f_proportion"        </span></span>
<span><span class="co">#&gt; [10] "f_proportion_sqrt"    "f_rescale_global"     "f_rescale_local"     </span></span>
<span><span class="co">#&gt; [13] "f_scale_global"       "f_scale_local"        "f_trend_linear"      </span></span>
<span><span class="co">#&gt; [16] "f_trend_poly"</span></span></code></pre></div>
<div class="section level5">
<h5 id="scale-adjustments">Scale Adjustments<a class="anchor" aria-label="anchor" href="#scale-adjustments"></a>
</h5>
<p>Scaling and centering multivariate time series is essential in
dynamic time warping to ensure all variables contribute equally,
regardless of their range or units.</p>
<p>For example, the dataset <code>fagus_dynamics</code> has variables in
different units.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_init</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/fagus_dynamics.html">fagus_dynamics</a></span>,</span>
<span>  name <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-60-1.png" width="750"></p>
<p>Due to the differences in magnitude between variables, a dynamic time
warping analysis will focus on <code>rainfall</code> disproportionately,
biasing the results.</p>
<p>To solve this issue, the package <code>distantia</code> implements
two flavors of scaling and/or centering:</p>
<ul>
<li>
<strong>Local</strong>: each variable is scaled and/or centered
independently by time series.</li>
<li>
<strong>Global</strong>: each variable is scaled and/or centering
using its mean and standard deviation across all time series.</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#local scaling</span></span>
<span><span class="va">tsl_local_scaling</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_scale_local.html">f_scale_local</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#global scaling</span></span>
<span><span class="va">tsl_global_scaling</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_scale_global.html">f_scale_global</a></span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The stats of both operations show that the global one preserves
variable offsets between locations, while the local one shows an average
0 and standard deviation 1 across all variables.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"variable"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#stats of local scaling</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_local_scaling</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="va">stats_cols</span><span class="op">]</span></span>
<span><span class="co">#&gt;      name    variable                       mean sd</span></span>
<span><span class="co">#&gt; 1 Germany         evi -0.00000000000000006831308  1</span></span>
<span><span class="co">#&gt; 2   Spain         evi -0.00000000000000002052254  1</span></span>
<span><span class="co">#&gt; 3  Sweden         evi  0.00000000000000007098864  1</span></span>
<span><span class="co">#&gt; 4 Germany    rainfall -0.00000000000000004628439  1</span></span>
<span><span class="co">#&gt; 5   Spain    rainfall -0.00000000000000014522160  1</span></span>
<span><span class="co">#&gt; 6  Sweden    rainfall  0.00000000000000021712177  1</span></span>
<span><span class="co">#&gt; 7 Germany temperature -0.00000000000000010904564  1</span></span>
<span><span class="co">#&gt; 8   Spain temperature  0.00000000000000006240186  1</span></span>
<span><span class="co">#&gt; 9  Sweden temperature  0.00000000000000004371794  1</span></span>
<span></span>
<span><span class="co">#stats of global scaling</span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_global_scaling</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="va">stats_cols</span><span class="op">]</span></span>
<span><span class="co">#&gt;      name    variable         mean        sd</span></span>
<span><span class="co">#&gt; 1 Germany         evi  0.274946362 0.8814083</span></span>
<span><span class="co">#&gt; 2   Spain         evi -0.198553830 0.7030354</span></span>
<span><span class="co">#&gt; 3  Sweden         evi -0.076392533 1.2715132</span></span>
<span><span class="co">#&gt; 4 Germany    rainfall -0.322755553 0.7018733</span></span>
<span><span class="co">#&gt; 5   Spain    rainfall  0.493472218 1.2122159</span></span>
<span><span class="co">#&gt; 6  Sweden    rainfall -0.170716665 0.8176955</span></span>
<span><span class="co">#&gt; 7 Germany temperature -0.009510512 1.0589824</span></span>
<span><span class="co">#&gt; 8   Spain temperature  0.360302107 0.7534701</span></span>
<span><span class="co">#&gt; 9  Sweden temperature -0.350791594 1.0324738</span></span></code></pre></div>
<p>The functions <code>f_rescale_local</code> and
<code>f_rescale_global</code> work under the same principle to rescale
variable ranges. By default, these functions rescale all time series
between 0 and 1, but the arguments <code>new_min</code> and
<code>new_max</code> can receive numeric vectors to set different ranges
for different variables.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_local_rescaling</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  f <span class="op">=</span> <span class="va">f_rescale_local</span>,</span>
<span>  new_min <span class="op">=</span> <span class="fl">0</span>, <span class="co">#same for all variables</span></span>
<span>  new_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tsl_global_rescaling</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  f <span class="op">=</span> <span class="va">f_rescale_global</span>,</span>
<span>  new_min <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  new_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The stats below show the results of the local and global
rescaling.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"variable"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_local_rescaling</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="va">stats_cols</span><span class="op">]</span></span>
<span><span class="co">#&gt;      name    variable min max</span></span>
<span><span class="co">#&gt; 1 Germany         evi   0   0</span></span>
<span><span class="co">#&gt; 2   Spain         evi   0   0</span></span>
<span><span class="co">#&gt; 3  Sweden         evi   0   0</span></span>
<span><span class="co">#&gt; 4 Germany    rainfall   0 100</span></span>
<span><span class="co">#&gt; 5   Spain    rainfall   0 100</span></span>
<span><span class="co">#&gt; 6  Sweden    rainfall   0 100</span></span>
<span><span class="co">#&gt; 7 Germany temperature   0  10</span></span>
<span><span class="co">#&gt; 8   Spain temperature   0  10</span></span>
<span><span class="co">#&gt; 9  Sweden temperature   0  10</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_global_rescaling</span></span>
<span><span class="op">)</span><span class="op">[</span>, <span class="va">stats_cols</span><span class="op">]</span></span>
<span><span class="co">#&gt;      name    variable        min       max</span></span>
<span><span class="co">#&gt; 1 Germany         evi 0.03304993 0.8519938</span></span>
<span><span class="co">#&gt; 2   Spain         evi 0.16944079 0.7209915</span></span>
<span><span class="co">#&gt; 3  Sweden         evi 0.00000000 1.0000000</span></span>
<span><span class="co">#&gt; 4 Germany    rainfall 0.00000000 0.6596244</span></span>
<span><span class="co">#&gt; 5   Spain    rainfall 0.03615023 1.0000000</span></span>
<span><span class="co">#&gt; 6  Sweden    rainfall 0.02206573 0.8732394</span></span>
<span><span class="co">#&gt; 7 Germany temperature 0.10035842 1.0000000</span></span>
<span><span class="co">#&gt; 8   Spain temperature 0.32974910 0.9462366</span></span>
<span><span class="co">#&gt; 9  Sweden temperature 0.00000000 0.8853047</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="trend-adjustments">Trend Adjustments<a class="anchor" aria-label="anchor" href="#trend-adjustments"></a>
</h5>
<p>Removing trends in time series before applying dynamic time warping
may help prevents inflated dissimilarity scores caused by non-stationary
components. Detrending also ensures that the alignment generated by
dynamic time warping focuses on meaningful shape features rather than
being distorted by long-term trends.</p>
<p>The transformation function <code>f_trend_linear</code> transforms
time series into their linear trend to help identify whether a time
series needs detrending or not.</p>
<p>The example below applies this function to the
<code>cities_temperature</code> dataset.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#loading cities_temperature as tsl</span></span>
<span><span class="va">tsl</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_init</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/cities_temperature.html">cities_temperature</a></span>,</span>
<span>  name <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#computing linear trends</span></span>
<span><span class="va">tsl_trend</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_trend_linear.html">f_trend_linear</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#plotting linear trends</span></span>
<span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_trend</span>,</span>
<span>  columns <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  line_color <span class="op">=</span> <span class="st">"red4"</span>,</span>
<span>  line_width <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-66-1.png" width="750"></p>
<p>We can now compute the stats of these linear trends to identify the
cities with a steeper long-term temperature change.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#compute stats of linear trends</span></span>
<span><span class="va">df_stats</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_trend</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#arrange from higher to lower range</span></span>
<span><span class="va">df_stats</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df_stats</span><span class="op">$</span><span class="va">range</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"range"</span><span class="op">)</span></span>
<span>  <span class="op">]</span></span>
<span><span class="co">#&gt;                name     range</span></span>
<span><span class="co">#&gt; 15           Moscow 1.6821989</span></span>
<span><span class="co">#&gt; 12           London 1.3864875</span></span>
<span><span class="co">#&gt; 19         Shanghai 1.3791695</span></span>
<span><span class="co">#&gt; 16            Paris 1.3286522</span></span>
<span><span class="co">#&gt; 6          Istanbul 1.3026069</span></span>
<span><span class="co">#&gt; 3             Cairo 1.2096175</span></span>
<span><span class="co">#&gt; 20            Tokyo 1.0892597</span></span>
<span><span class="co">#&gt; 8           Karachi 1.0320425</span></span>
<span><span class="co">#&gt; 18        São Paulo 0.8453958</span></span>
<span><span class="co">#&gt; 13      Los Angeles 0.8322052</span></span>
<span><span class="co">#&gt; 17   Rio De Janeiro 0.7802845</span></span>
<span><span class="co">#&gt; 10            Lagos 0.7670465</span></span>
<span><span class="co">#&gt; 9          Kinshasa 0.6908596</span></span>
<span><span class="co">#&gt; 7           Jakarta 0.6667040</span></span>
<span><span class="co">#&gt; 2            Bogotá 0.4577014</span></span>
<span><span class="co">#&gt; 5  Ho Chi Minh City 0.3983325</span></span>
<span><span class="co">#&gt; 14           Manila 0.3216708</span></span>
<span><span class="co">#&gt; 1           Bangkok 0.2431807</span></span>
<span><span class="co">#&gt; 11             Lima 0.2421891</span></span>
<span><span class="co">#&gt; 4             Dhaka 0.2317552</span></span></code></pre></div>
<p>Now that we identified the issue, the function
<code>f_detrend_linear</code> helps remove these temporal trends from
the data.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_detrended</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_detrend_linear.html">f_detrend_linear</a></span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The code below applies <code>f_trend_linear</code> again to
demonstrate that the linear detrending worked as expected.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_trend</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_detrended</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_trend_linear.html">f_trend_linear</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_stats</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_trend</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_stats</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"range"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                name                      range</span></span>
<span><span class="co">#&gt; 1           Bangkok 0.000000000000000328592658</span></span>
<span><span class="co">#&gt; 2            Bogotá 0.000000000000000484878289</span></span>
<span><span class="co">#&gt; 3             Cairo 0.000000000000000943646582</span></span>
<span><span class="co">#&gt; 4             Dhaka 0.000000000000000329773971</span></span>
<span><span class="co">#&gt; 5  Ho Chi Minh City 0.000000000000000890841633</span></span>
<span><span class="co">#&gt; 6          Istanbul 0.000000000000000808987093</span></span>
<span><span class="co">#&gt; 7           Jakarta 0.000000000000001206220863</span></span>
<span><span class="co">#&gt; 8           Karachi 0.000000000000000581163990</span></span>
<span><span class="co">#&gt; 9          Kinshasa 0.000000000000002226721698</span></span>
<span><span class="co">#&gt; 10            Lagos 0.000000000000001024499755</span></span>
<span><span class="co">#&gt; 11             Lima 0.000000000000000709047629</span></span>
<span><span class="co">#&gt; 12           London 0.000000000000000614810456</span></span>
<span><span class="co">#&gt; 13      Los Angeles 0.000000000000000469843877</span></span>
<span><span class="co">#&gt; 14           Manila 0.000000000000000006671831</span></span>
<span><span class="co">#&gt; 15           Moscow 0.000000000000000851634434</span></span>
<span><span class="co">#&gt; 16            Paris 0.000000000000000317550377</span></span>
<span><span class="co">#&gt; 17   Rio De Janeiro 0.000000000000000841054716</span></span>
<span><span class="co">#&gt; 18        São Paulo 0.000000000000000464026082</span></span>
<span><span class="co">#&gt; 19         Shanghai 0.000000000000000087755817</span></span>
<span><span class="co">#&gt; 20            Tokyo 0.000000000000001516265533</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="compositional-normalization">Compositional Normalization<a class="anchor" aria-label="anchor" href="#compositional-normalization"></a>
</h5>
<p>The <code>distantia</code> package offers several transformations for
compositional data:</p>
<ul>
<li>
<code>f_percent</code>: percentages.</li>
<li>
<code>f_proportion</code>: proportions.</li>
<li>
<code>f_proportion_sqrt</code>: square root of proportions</li>
<li>
<code>f_hellinger</code>: transforms to proportion and applies
Hellinger transformation.</li>
<li>
<code>f_clr</code>: centered log-ratio.</li>
<li>
<code>f_log</code>: logarithm transformation.</li>
<li>
<code>f_binary</code>: transform continuous data into discrete
events.</li>
</ul>
<p>The example below shows the application of several of these
transformation on the counts dataset <code>eemian_pollen</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_counts</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_init</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/eemian_pollen.html">eemian_pollen</a></span>,</span>
<span>  name <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; distantia::utils_prepare_time():  duplicated time indices in 'Krumbach_I':</span></span>
<span><span class="co">#&gt; - value 6.8 replaced with 6.825.</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_counts</span>,</span>
<span>  guide_columns <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-71-1.png" width="750">
Transformation to percentages with <code>f_percent</code>.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_percent</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_counts</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_percent.html">f_percent</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_percent</span>,</span>
<span>  guide_columns <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-72-1.png" width="750">
The function <code>f_binary</code> helps transform continuous data into
discrete events. The code below converts the percentages above into
presence/absence using 5% as threshold. Notice only the variable
“Carpinus” is shown in the plot to facilitate visualization.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_binary</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_percent</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_binary.html">f_binary</a></span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>    tsl <span class="op">=</span> <span class="va">tsl_binary</span>,</span>
<span>    colnames <span class="op">=</span> <span class="st">"Carpinus"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-73-1.png" width="750"></p>
<p>Transformation to square root of proportions with
<code>f_proportion_sqrt</code>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_prop_sqrt</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_counts</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_proportion_sqrt.html">f_proportion_sqrt</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_prop_sqrt</span>,</span>
<span>  guide_columns <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-74-1.png" width="750"></p>
<p>The function <code>f_hellinger</code> transforms the taxa counts to
proportions and the applies the Hellinger transformation.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_hellinger</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_counts</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_hellinger.html">f_hellinger</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_hellinger</span>, </span>
<span>  guide_columns <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-75-1.png" width="750"></p>
<p>Centered log-ration computed with <code>f_clr</code>.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_clr</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_counts</span>,</span>
<span>  f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_clr.html">f_clr</a></span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_clr</span>, </span>
<span>  guide_columns <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="time_series_lists_files/figure-html/unnamed-chunk-76-1.png" width="750"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
