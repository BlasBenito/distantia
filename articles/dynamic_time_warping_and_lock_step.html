<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dynamic Time Warping vs Lock-Step • distantia</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Dynamic Time Warping vs Lock-Step">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">distantia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/dynamic_time_warping_and_lock_step.html">Dynamic Time Warping vs Lock-Step</a></li>
    <li><a class="dropdown-item" href="../articles/time_series_lists.html">Handling Time Series Lists</a></li>
    <li><a class="dropdown-item" href="../articles/mapping_dissimilarity.html">Mapping Time Series Dissimilarity</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Articles</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/dynamic-time-warping/">A Gentle Intro to Dynamic Time Warping</a></li>
    <li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/dynamic-time-warping-from-scratch/">Coding a Minimalistic DTW Library</a></li>
    <li><a class="dropdown-item" href="../articles/dtw_applications.html">Implementations and Applications of Dynamic Time Warping</a></li>
    <li><a class="dropdown-item" href="../articles/distantia_in_the_wild.html">distantia In The Wild</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Original Paper</h6></li>
    <li><a class="external-link dropdown-item" href="https://nsojournals.onlinelibrary.wiley.com/doi/full/10.1111/ecog.04895">Benito &amp; Birks 2020 (Ecography)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BlasBenito/distantia/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Dynamic Time Warping vs Lock-Step</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BlasBenito/distantia/blob/main/vignettes/articles/dynamic_time_warping_and_lock_step.Rmd" class="external-link"><code>vignettes/articles/dynamic_time_warping_and_lock_step.Rmd</code></a></small>
      <div class="d-none name"><code>dynamic_time_warping_and_lock_step.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The R package <code>distantia</code> provides tools for comparing
time series through two distinct methods: dynamic time warping (DTW) and
lock-step (LS). These approaches cater to different analysis needs: DTW
for handling temporal shifts and LS for preserving temporal alignment.
This article explores the conceptual foundations of both methods, their
implementation in <code>distantia</code>, and showcases their practical
use with code examples.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>The packages required to run the code in this article are
<code>distantia</code> and <code>dtw</code>. The latter is not a
dependency of <code>distantia</code>, but will help put into context key
details of how DTW works.</p>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>The <code>cities_temperature</code> dataset contains monthly
temperature records for 20 cities. The code below transforms it into a
Time Series List (TSL) and selects a subset of three cities with
temperature time series from 2000 to 2005.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_raw</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_initialize.html">tsl_initialize</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">cities_temperature</span>,</span>
<span>  name_column <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  time_column <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Paris"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span>,</span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2000-01-01"</span>, <span class="st">"2005-01-01"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  ylim <span class="op">=</span> <span class="st">"relative"</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-4-1.png" width="750"></p>
<p>The transformed TSL contains two synchronous time series in the
Northern Hemisphere with similar temperature ranges (London and Paris)
and one in the Southern Hemisphere (Kinshasa) with a higher average and
a shifted temporal pattern.</p>
<p>To facilitate the comparison of DTW and LS, the code below applies
the functions <code><a href="../reference/tsl_transform.html">tsl_transform()</a></code> with
<code>f_detrend_linear</code> to remove any long-term trends in the
data, and with <code>f_scale</code> to scale and center each time series
separately.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_scaled</span> <span class="op">&lt;-</span> <span class="va">tsl_raw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_detrend_linear.html">f_detrend_linear</a></span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="fu">distantia</span><span class="fu">::</span><span class="va"><a href="../reference/f_scale_local.html">f_scale_local</a></span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span>,</span>
<span>  ylim <span class="op">=</span> <span class="st">"relative"</span>,</span>
<span>  guide <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-5-1.png" width="750"></p>
</div>
<div class="section level2">
<h2 id="lock-step-ls">Lock-Step (LS)<a class="anchor" aria-label="anchor" href="#lock-step-ls"></a>
</h2>
<p><strong>Lock-step</strong> methods compare values at corresponding
time points, requiring time series of the same length sampled at
identical times. This approach is well-suited for cases where
maintaining the temporal alignment of the compared time series is
crucial. The method is straightforward and computationally
efficient.</p>
<p>In <code>distantia</code>, lock-step comparisons are carried out in
three steps:</p>
<p><strong>1.-</strong> Sum the distances between pairs of samples
observed at the same times.</p>
<p><strong>2.-</strong> Sum the distances between consecutive samples
within each time series.</p>
<p><strong>3.-</strong> Compute the normalized dissimilarity score
<em>psi</em>.</p>
<p>Let’s look first at a native R implementation of this idea using
euclidean distances to keep it simple.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#extracting the data to shorten variable names</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tsl_scaled</span><span class="op">$</span><span class="va">London</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">tsl_scaled</span><span class="op">$</span><span class="va">Kinshasa</span></span>
<span></span>
<span><span class="co">#1.- sum of distances between pairs of samples</span></span>
<span><span class="va">step_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#2.- sum of distances between consecutive samples</span></span>
<span><span class="va">step_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#3.- compute normalized dissimilarity score</span></span>
<span><span class="op">(</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">step_1</span><span class="op">)</span> <span class="op">/</span> <span class="va">step_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.791279</span></span></code></pre></div>
<p>The function <code><a href="../reference/distantia.html">distantia()</a></code> performs the same task when
<code>lock_step = TRUE</code> (default is <code>FALSE</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">psi</span></span>
<span><span class="co">#&gt; [1] 2.791279</span></span></code></pre></div>
<p>The same can be done with the function <code><a href="../reference/distantia_ls.html">distantia_ls()</a></code>, a
simplified version of <code><a href="../reference/distantia.html">distantia()</a></code> for lock-step
analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/distantia_ls.html">distantia_ls</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">psi</span></span>
<span><span class="co">#&gt; [1] 2.791279</span></span></code></pre></div>
<p>Both functions can compute lock-step dissimilarity scores for all
time series in the argument <code>tsl</code> at once.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/distantia_ls.html">distantia_ls</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y       psi</span></span>
<span><span class="co">#&gt; 1 London    Paris 0.2298458</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa 2.7046009</span></span>
<span><span class="co">#&gt; 2 London Kinshasa 2.7912785</span></span></code></pre></div>
<p>As expected, London and Paris show the most similar temperature time
series, while London and Kinshasa are the most different ones.</p>
</div>
<div class="section level2">
<h2 id="dynamic-time-warping">Dynamic Time Warping<a class="anchor" aria-label="anchor" href="#dynamic-time-warping"></a>
</h2>
<p>Dynamic Time Warping (DTW) warps the time axes of two time series to
maximize pattern similarity, even when temporal shifts are present. This
makes DTW ideal for comparing time series with similar shapes but
misaligned time points. However, it is computationally more intensive
and less efficient than the lock-step method, particularly for large
datasets.</p>
<p>DTW involves three conceptual steps, similar to the lock-step method,
but with additional complexity in the first step:</p>
<p><strong>1.-</strong> Sum the distances between pairs of samples.</p>
<ul>
<li><p><strong>1a</strong> Compute a distance matrix between all pairs
of samples.</p></li>
<li><p><strong>1b</strong> Build the least-cost matrix.</p></li>
<li><p><strong>1c</strong> Find the least-cost path.</p></li>
<li><p><strong>1d</strong> Sum distances along the least-cost
path.</p></li>
</ul>
<p><strong>2.-</strong> Sum distances between consecutive samples within
each time series.</p>
<p><strong>3.-</strong> Calculate the normalized dissimilarity score
<em>psi</em> (with a slightly different formula!).</p>
<p>Now, let’s dive into the code.</p>
<p>The objective of the step <strong>1</strong> is computing the sum of
distances between pairs of samples matched together by the time warping
algorithm.</p>
<p>Step <strong>1a</strong> computes the distance matrix between all
pairs of samples in both time series. Notice that all functions to
demonstrate the computation of the normalized dissimilarity score
<code>psi</code> follow the naming convention <code>psi...()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.dist</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/psi_distance_matrix.html">psi_distance_matrix</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/utils_matrix_plot.html">utils_matrix_plot</a></span><span class="op">(</span></span>
<span>  m <span class="op">=</span> <span class="va">m.dist</span>,</span>
<span>  diagonal_width <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-11-1.png" width="600"></p>
<p>Step <strong>1b</strong> involves transforming the distance matrix
into a cost matrix. This transformation requires a dynamic algorithm in
which each new cell adds its own distance to the distance accumulated by
its preceding neighbor. There are two implementations of this method in
<code>distantia</code>:</p>
<ul>
<li>
<strong>orthogonal only</strong>: distance cost is only computed on
the <em>x</em> and <em>y</em> axis, ignoring diagonals.</li>
<li>
<strong>orthogonal and diagonal</strong>: distance cost is also
computed in diagonals, which are weighted by a factor of
<code>1.414214 (square root of 2)</code>.</li>
</ul>
<p>These options are wrapped in the function
<code><a href="../reference/psi_cost_matrix.html">psi_cost_matrix()</a></code>, which by default, like
<code><a href="../reference/distantia.html">distantia()</a></code> uses weighted diagonals.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.cost</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/psi_cost_matrix.html">psi_cost_matrix</a></span><span class="op">(</span></span>
<span>  dist_matrix <span class="op">=</span> <span class="va">m.dist</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="cn">TRUE</span> <span class="co">#default</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/utils_matrix_plot.html">utils_matrix_plot</a></span><span class="op">(</span></span>
<span>  m <span class="op">=</span> <span class="va">m.cost</span>,</span>
<span>  diagonal_width <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-12-1.png" width="600"></p>
<p>In step <strong>1c</strong>, the distance and cost matrices are used
to find the least-cost path.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.cost.path</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/psi_cost_path.html">psi_cost_path</a></span><span class="op">(</span></span>
<span>  dist_matrix <span class="op">=</span> <span class="va">m.dist</span>,</span>
<span>  cost_matrix <span class="op">=</span> <span class="va">m.cost</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="cn">TRUE</span> <span class="co">#default</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">m.cost.path</span><span class="op">)</span></span>
<span><span class="co">#&gt;    x y       dist     cost</span></span>
<span><span class="co">#&gt; 76 6 3 0.09082845 4.579160</span></span>
<span><span class="co">#&gt; 77 5 2 0.19227643 4.450709</span></span>
<span><span class="co">#&gt; 78 4 1 0.71503492 4.178789</span></span>
<span><span class="co">#&gt; 79 3 1 0.88127572 3.463754</span></span>
<span><span class="co">#&gt; 80 2 1 1.14678108 2.582479</span></span>
<span><span class="co">#&gt; 81 1 1 1.43569743 1.435697</span></span></code></pre></div>
<p>Notice that the cost path data frame is ordered from bottom to top.
The columns “x” and “y” represent sample indices of the time series
London and Kinshasa. The figure below shows the least cost path on top
of the cost matrix.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/utils_matrix_plot.html">utils_matrix_plot</a></span><span class="op">(</span></span>
<span>  m <span class="op">=</span> <span class="va">m.cost</span>,</span>
<span>  path <span class="op">=</span> <span class="va">m.cost.path</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-14-1.png" width="600"></p>
<p>The step <strong>1d</strong> finalizes the DTW logic by adding the
distances between pair of samples connected by the least-cost path. This
step is just <code>sum(m.cost.path$dist)</code>, but it is implemented
in <code><a href="../reference/psi_cost_path_sum.html">psi_cost_path_sum()</a></code>, which also checks that the least
cost data frame is correct.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step_1</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/psi_cost_path_sum.html">psi_cost_path_sum</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="va">m.cost.path</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">step_1</span></span>
<span><span class="co">#&gt; [1] 36.18196</span></span></code></pre></div>
<p>Step <strong>2</strong> returns the distances between consecutive
samples within each time series, as computed by
<code><a href="../reference/psi_auto_sum.html">psi_auto_sum()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step_2</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/psi_auto_sum.html">psi_auto_sum</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">step_2</span></span></code></pre></div>
<p>Finally, the step <strong>3</strong> computes the normalized
dissimilarity score.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/psi_equation.html">psi_equation</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="va">step_1</span>,</span>
<span>  b <span class="op">=</span> <span class="va">step_2</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>All these individual steps can be performed at once with the function
<code><a href="../reference/distantia.html">distantia()</a></code> by setting the argument <code>lock_step</code>
to <code>FALSE</code>, or with the function
<code><a href="../reference/distantia_dtw.html">distantia_dtw()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y      psi</span></span>
<span><span class="co">#&gt; 1 London Kinshasa 1.051902</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/distantia_dtw.html">distantia_dtw</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y      psi</span></span>
<span><span class="co">#&gt; 1 London Kinshasa 1.051902</span></span></code></pre></div>
<p>As before, both functions can compute dynamic time warping
dissimilarity for all time series in the argument <code>tsl</code> at
once.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">distantia</span><span class="fu">::</span><span class="fu"><a href="../reference/distantia_dtw.html">distantia_dtw</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y       psi</span></span>
<span><span class="co">#&gt; 1 London    Paris 0.2177902</span></span>
<span><span class="co">#&gt; 2 London Kinshasa 1.0519019</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa 1.1054414</span></span></code></pre></div>
<p>The function <code><a href="../reference/distantia_dtw_plot.html">distantia_dtw_plot()</a></code> offers a good
graphical representation of the warping result and decomposes the
computation of the <em>psi</em> dissimilarity score.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_dtw_plot.html">distantia_dtw_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-21-1.png" width="900"></p>
<div class="section level4">
<h4 id="pitfalls">Pitfalls<a class="anchor" aria-label="anchor" href="#pitfalls"></a>
</h4>
<p>DTW is an ideal method to compare time series with temporal shifts,
and is applicable to regular and irregular time series with the same or
different numbers of samples.</p>
<p>However, <strong>DTW is highly sensitive to differences in data
magnitudes</strong>. As result, data that is not properly scaled may
distort the warping, leading to .</p>
<p>The plot below represents the DTW alignment of London and Kinshasa on
the raw temperature data. It shows how DTW gets stuck in two local
optima, one in the <em>y</em> axis (long horizontal line) at the minimum
temperature in Kinshasa (winter of 2001), and another in the <em>x</em>
axis (long vertical line) at the maximum temperature in London (summer
of 2003). It also shows a distinctively large dissimilarity score.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_dtw_plot.html">distantia_dtw_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-22-1.png" width="900"></p>
<p>These long horizontal and vertical lines shown above provide an
immediate diagnostic of a <strong>pathological warping</strong>, which
happens when a relatively short segment of one time series maps to a
much longer segment of another.</p>
<p>This is not a particular issue of the DTW algorithm implemented in
<code>distantia</code>, but a general behavior of time warping methods.
The code below shows a similar analysis performed with the R package <a href="https://CRAN.R-project.org/package=dtw" class="external-link"><code>dtw</code></a>. The
default implementation ignores diagonals when building the cost
matrix.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_dtw</span> <span class="op">&lt;-</span> <span class="fu">dtw</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtw/man/dtw.html" class="external-link">dtw</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">$</span><span class="va">London</span><span class="op">$</span><span class="va">temperature</span>,</span>
<span>  y <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">$</span><span class="va">Kinshasa</span><span class="op">$</span><span class="va">temperature</span>,</span>
<span>  keep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xy_dtw</span>, type <span class="op">=</span> <span class="st">"threeway"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-23-1.png" width="750"></p>
<p>The “twoway” plot provided by <code>dtw</code> shows the alingment as
a line bar, with the sample matches represented as dotted lines, and two
vertical lines highlighting the local optima</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xy_dtw</span>, type <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0.13</span>, col<span class="op">=</span><span class="st">"red3"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0.70</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-24-1.png" width="750"></p>
<p>There are two strategies that can be combined to control this issue:
data scaling, and <strong>constrained DTW</strong>.</p>
</div>
<div class="section level3">
<h3 id="constrained-dtw">Constrained DTW<a class="anchor" aria-label="anchor" href="#constrained-dtw"></a>
</h3>
<p>The function <code><a href="../reference/distantia.html">distantia()</a></code> implements <em>Sakoe-Chiba
bands</em> to restrict the flexibility of the warping path via the
<code>bandwidth</code> argument. This argument represents the fraction
of space at both sides of the least cost matrix diagonal allowed for
warping. The plots below show the effect of decreasing
<code>bandwidth</code> on the area covered by the Sakoe-Chiba bands
(shown as white dashed lines) and how it restricts spread of the
alignment between London and Kinshasa on their raw temperature
values.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_dtw_plot.html">distantia_dtw_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  bandwidth <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-25-1.png" width="900"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_dtw_plot.html">distantia_dtw_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  bandwidth <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-26-1.png" width="900"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_dtw_plot.html">distantia_dtw_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  bandwidth <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-27-1.png" width="900"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_dtw_plot.html">distantia_dtw_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  bandwidth <span class="op">=</span> <span class="fl">0.025</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-28-1.png" width="900"></p>
<p>Sakoe-Chiba bands cannot fix bad alignments (that’s what data scaling
is for), but can help diagnose them, given a tolerance level.</p>
<p>The code below runs <code><a href="../reference/distantia.html">distantia()</a></code> for the raw temperature
data with two bandwidths: 1 for unrestricted dynamic time warping, and
0.25 as reference level.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  bandwidth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span>, <span class="st">"bandwidth"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y        psi bandwidth</span></span>
<span><span class="co">#&gt; 1 London    Paris  0.4241914      1.00</span></span>
<span><span class="co">#&gt; 4 London    Paris  0.4241914      0.25</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa  7.3672711      1.00</span></span>
<span><span class="co">#&gt; 6  Paris Kinshasa  7.6432712      0.25</span></span>
<span><span class="co">#&gt; 5 London Kinshasa 10.2494423      0.25</span></span>
<span><span class="co">#&gt; 2 London Kinshasa 10.7561509      1.00</span></span></code></pre></div>
<p>Now, we can compute the psi differences across bandwidths for each
pair of time series</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">y</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    psi_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">psi</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'x'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   x [2]</span></span></span>
<span><span class="co">#&gt;   x      y        psi_diff</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> London Kinshasa    0.507</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> London Paris       0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Paris  Kinshasa    0.276</span></span></code></pre></div>
<p>All pairs of time series with a <code>psi_diff</code> higher than
zero show warping paths that go beyond the 0.25 bandwidth.</p>
</div>
</div>
<div class="section level2">
<h2 id="comparing-dtw-and-ls">Comparing DTW and LS<a class="anchor" aria-label="anchor" href="#comparing-dtw-and-ls"></a>
</h2>
<p>Dynamic Time Warping (DTW) and Lock-Step (LS) methods differ in scope
and application.</p>
<p>DTW is ideal for comparing data that may be shifted in time due to
positional differences, such as phenological time series observed across
different hemispheres or elevations. It also facilitates the comparison
of time series with varying lengths, observation periods, or sampling
resolutions. This versatility makes DTW a general-purpose tool for time
series analysis.</p>
<p>In contrast, LS is designed for synchronized time series that, at a
minimum, must have the same length. While its scope is narrower, LS is
more intuitive and accurate than DTW for comparing time series without
time shifts, as it measures raw differences directly.</p>
<p>In essence, DTW, with its ability to adjust the time axis, answers
the question, <em>How similar can these two time series be?</em>, while
LS addresses the question, “How different are these two time
series?”</p>
<p>The code below computes the dissimilarity score of the temperatures
in Paris, London, and Kinshasa using DTW and LS and compares them in a
data frame.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_dtw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">df_dtw</span><span class="op">$</span><span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">df_dtw</span><span class="op">$</span><span class="va">y</span>,</span>
<span>  psi_dtw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">df_dtw</span><span class="op">$</span><span class="va">psi</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  psi_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">df_ls</span><span class="op">$</span><span class="va">psi</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;        x        y psi_dtw psi_ls</span></span>
<span><span class="co">#&gt; 1 London    Paris   0.218  0.230</span></span>
<span><span class="co">#&gt; 2 London Kinshasa   1.052  2.705</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa   1.105  2.791</span></span></code></pre></div>
<p>For London and Paris, both DTW and LS show very similar values,
because the time series are very similar and DTW cannot do much else to
adjust them even more. On the other hand, DTW shows much lower values
than LS when Kinshasa comes into play, as it compensates the seasonal
shifts in these time series. In that sense, LS provides a more accurate
image of the raw differences between these time series.</p>
<p>As a clear advantage, LS does not require data normalization for
univariate time series, and therefore can provide a dissimilarity score
in the same units of the variable at hand.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_ls</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y       psi</span></span>
<span><span class="co">#&gt; 1 London    Paris 0.4879081</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa 7.5416106</span></span>
<span><span class="co">#&gt; 2 London Kinshasa 9.3361647</span></span></code></pre></div>
<p>Comparing the dissimilarity scores above with the mean temperatures
of the three cities below can give a sense of how approximate LS scores
are to what we could expect.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_stats</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;       name     mean</span></span>
<span><span class="co">#&gt; 1   London 10.55682</span></span>
<span><span class="co">#&gt; 2    Paris 11.53803</span></span>
<span><span class="co">#&gt; 3 Kinshasa 24.48500</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="closing-thoughts">Closing Thoughts<a class="anchor" aria-label="anchor" href="#closing-thoughts"></a>
</h2>
<p>The <code>distantia</code> package strikes a balance between
flexibility and simplicity, enabling a more nuanced exploration of time
series data. With support for both dynamic time warping and lock-step
methods, it provides users with the tools needed to uncover insights
while respecting the unique constraints of their data. Whether you’re
working on sequence alignment or strict temporal comparisons,
<code>distantia</code> is designed to adapt to your analytical
needs.</p>
<p>I encourage you to give it a try and see how it fits into your
workflows.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
