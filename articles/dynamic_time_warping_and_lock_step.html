<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dynamic Time Warping vs Lock-Step • distantia</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Dynamic Time Warping vs Lock-Step">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">distantia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/dynamic_time_warping_and_lock_step.html">Dynamic Time Warping vs Lock-Step</a></li>
    <li><a class="dropdown-item" href="../articles/time_series_lists.html">Handling Time Series Lists</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Original Paper</h6></li>
    <li><a class="external-link dropdown-item" href="https://nsojournals.onlinelibrary.wiley.com/doi/full/10.1111/ecog.04895">Benito &amp; Birks 2020 (Ecography)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BlasBenito/distantia/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Dynamic Time Warping vs Lock-Step</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BlasBenito/distantia/blob/main/vignettes/articles/dynamic_time_warping_and_lock_step.Rmd" class="external-link"><code>vignettes/articles/dynamic_time_warping_and_lock_step.Rmd</code></a></small>
      <div class="d-none name"><code>dynamic_time_warping_and_lock_step.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The R package <code>distantia</code> provides tools for comparing
time series through two distinct methods: dynamic time warping (DTW) and
lock-step (LS). These approaches cater to different analysis needs—DTW
for handling temporal shifts and LS for preserving temporal alignment.
This article explores the conceptual foundations of both methods, their
implementation in <code>distantia</code>, and showcases their practical
use with illustrative code examples and visualizations.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>The packages required to run the code in this article are
<code>distantia</code> and <code>dtw</code>.</p>
</div>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>The <code>cities_temperature</code> dataset contains monthly
temperature records for 20 cities. Below, we transform it into a Time
Series List (TSL) and select a subset of three cities from 2000 to 2005
for demonstration</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_initialize.html">tsl_initialize</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">cities_temperature</span>,</span>
<span>  name_column <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  time_column <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/tsl_subset.html">tsl_subset</a></span><span class="op">(</span></span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"London"</span>, </span>
<span>      <span class="st">"Paris"</span>, </span>
<span>      <span class="st">"Kinshasa"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"2000-01-01"</span>, </span>
<span>      <span class="st">"2005-01-01"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  ylim <span class="op">=</span> <span class="st">"relative"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-4-1.png" width="2187.5"></p>
<p>The transformed TSL contains two synchronous time series with similar
temperature ranges (London and Paris) and one (Kinshasa) with higher
averages and a shifted temporal pattern.</p>
<p>To facilitate the comparison of DTW and LS, the code below applies
the functions <code><a href="../reference/tsl_transform.html">tsl_transform()</a></code> and <code>f_scale</code> to
center and scale the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tsl_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_transform.html">tsl_transform</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  f <span class="op">=</span> <span class="va">f_scale_local</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsl_plot.html">tsl_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-5-1.png" width="2187.5"></p>
</div>
<div class="section level2">
<h2 id="lock-step-ls">Lock-Step (LS)<a class="anchor" aria-label="anchor" href="#lock-step-ls"></a>
</h2>
<p><strong>Lock-step</strong> methods compare values at corresponding
time points, requiring time series of the same length sampled at
identical times. This approach is well-suited for cases where
maintaining the temporal alignment of the compared time series is
crucial. The method is straightforward and computationally
efficient.</p>
<p>In <code>distantia</code>, lock-step comparisons are carried out in
three steps:</p>
<p><strong>1.-</strong> Sum the distances between pairs of samples
observed at the same time.</p>
<p><strong>2.-</strong> Sum the distances between consecutive samples
within each time series.</p>
<p><strong>3.-</strong> Compute the normalized dissimilarity score
<em>psi</em>.</p>
<p>Let’s look first at a native R implementation of this idea using
euclidean distances to keep it simple.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#extracting the data to shorter variables</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tsl_scaled</span><span class="op">$</span><span class="va">London</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">tsl_scaled</span><span class="op">$</span><span class="va">Kinshasa</span></span>
<span></span>
<span><span class="co">#1.- sum of distances between pairs of samples</span></span>
<span><span class="va">step_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#2.- sum of distances between consecutive samples</span></span>
<span><span class="va">step_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">#3.- compute normalized dissimilarity score</span></span>
<span><span class="op">(</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">step_1</span><span class="op">)</span> <span class="op">/</span> <span class="va">step_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.792455</span></span></code></pre></div>
<p>The function <code><a href="../reference/distantia.html">distantia()</a></code> performs this task when
<code>lock_step = TRUE</code> (default is <code>FALSE</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loading required package: future</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">psi</span></span>
<span><span class="co">#&gt; [1] 2.792455</span></span></code></pre></div>
<p>The function <code><a href="../reference/distantia.html">distantia()</a></code> can compute LS-based
dissimilarity scores for time series in <code>tsl</code> at once.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_LS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df_LS</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y       psi</span></span>
<span><span class="co">#&gt; 1 London    Paris 0.2427342</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa 2.7153379</span></span>
<span><span class="co">#&gt; 2 London Kinshasa 2.7924554</span></span></code></pre></div>
<p>As expected, London and Paris show the most similar temperature time
series, while London and Kinshasa are the most different ones.</p>
</div>
<div class="section level2">
<h2 id="dynamic-time-warping">Dynamic Time Warping<a class="anchor" aria-label="anchor" href="#dynamic-time-warping"></a>
</h2>
<p>Dynamic Time Warping (DTW) aligns the time axes of two time series to
maximize pattern similarity, even when temporal shifts are present. This
makes DTW ideal for comparing time series with similar shapes but
misaligned time points. However, it is computationally more intensive
and less efficient than the lock-step method, particularly for large
datasets.</p>
<p>DTW involves three conceptual steps, similar to the lock-step method,
but with additional complexity in the first step:</p>
<p><strong>1.-</strong> Sum the distances between pairs of samples.</p>
<ul>
<li><p><strong>1a</strong> Compute a distance matrix between all pairs
of samples.</p></li>
<li><p><strong>1b</strong> Build the least-cost matrix.</p></li>
<li><p><strong>1c</strong> Find the least-cost path.</p></li>
<li><p><strong>1d</strong> Sum distances along the least-cost
path.</p></li>
</ul>
<p><strong>2.-</strong> Sum distances between consecutive samples within
each time series.</p>
<p><strong>3.-</strong> Calculate the normalized dissimilarity score
<em>psi</em> (with a slightly different formula!).</p>
<p>Now, let’s dive into the code.</p>
<p>The objective of the step <strong>1</strong> is computing the sum of
distances between pairs of samples matched together by the time warping
algorithm.</p>
<p>It starts with step <strong>1a</strong>, shown below, which computes
the distance matrix between all pairs of samples. Notice that all
functions to demonstrate the computation of the normalized dissimilarity
score <code>psi</code> follow the naming convention
<code>psi...()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psi_distance_matrix.html">psi_distance_matrix</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/utils_matrix_plot.html">utils_matrix_plot</a></span><span class="op">(</span></span>
<span>  m <span class="op">=</span> <span class="va">m.dist</span>,</span>
<span>  diagonal_width <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-10-1.png" width="1200"></p>
<p>Step <strong>1b</strong> involves transforming the distance matrix
into a cost matrix. This transformation requires a dynamic algorithm in
which each new cell adds its own distance to the distance accumulated by
its preceding neighbor. There are two implementations of this method in
<code>distantia</code>:</p>
<ul>
<li>
<strong>orthogonal only</strong>: distance cost is only computed on
the <em>x</em> and <em>y</em> axis, ignoring diagonals.</li>
<li>
<strong>orthogonal and diagonal</strong>: distance cost is also
computed in diagonals, which are weighted by a factor of
<code>1.414214</code>.</li>
</ul>
<p>These options are wrapped in the function
<code><a href="../reference/psi_cost_matrix.html">psi_cost_matrix()</a></code>, which by default, like
<code><a href="../reference/distantia.html">distantia()</a></code> uses weighted diagonals.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.cost</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psi_cost_matrix.html">psi_cost_matrix</a></span><span class="op">(</span></span>
<span>  dist_matrix <span class="op">=</span> <span class="va">m.dist</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="cn">TRUE</span> <span class="co">#default</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/utils_matrix_plot.html">utils_matrix_plot</a></span><span class="op">(</span></span>
<span>  m <span class="op">=</span> <span class="va">m.cost</span>,</span>
<span>  diagonal_width <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-11-1.png" width="1200"></p>
<p>In step <strong>1c</strong>, the distance and cost matrices are used
to find the least-cost path.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.cost.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psi_cost_path.html">psi_cost_path</a></span><span class="op">(</span></span>
<span>  dist_matrix <span class="op">=</span> <span class="va">m.dist</span>,</span>
<span>  cost_matrix <span class="op">=</span> <span class="va">m.cost</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="cn">TRUE</span> <span class="co">#default</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/utils_matrix_plot.html">utils_matrix_plot</a></span><span class="op">(</span></span>
<span>  m <span class="op">=</span> <span class="va">m.cost</span>,</span>
<span>  path <span class="op">=</span> <span class="va">m.cost.path</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-12-1.png" width="1200"></p>
<p>The time warping is implicit in the coordinates of the least cost
path. For example, in the lower left corner of the plot above, the first
sample of Kinshasa (column “y”) is paired with the samples 1 to 4 of
London (column “x”). Please notice that the cost-path data frame has the
origin cell in the last row.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">m.cost.path</span><span class="op">)</span></span>
<span><span class="co">#&gt;    x y       dist     cost</span></span>
<span><span class="co">#&gt; 73 6 3 0.09001854 4.820301</span></span>
<span><span class="co">#&gt; 74 5 2 0.36818140 4.126921</span></span>
<span><span class="co">#&gt; 75 4 1 0.53175876 3.460522</span></span>
<span><span class="co">#&gt; 76 3 1 0.70059611 2.928764</span></span>
<span><span class="co">#&gt; 77 2 1 0.96840001 2.228167</span></span>
<span><span class="co">#&gt; 78 1 1 1.25976738 1.259767</span></span></code></pre></div>
<p>The step <strong>1d</strong> finalizes the DTW logic by adding the
distances between pair of samples connected by the least-cost path. This
istep is just <code>sum(m.cost.path$dist)</code>, but it is implemented
in <code><a href="../reference/psi_cost_path_sum.html">psi_cost_path_sum()</a></code>, which also checks that the path
file is correct.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psi_cost_path_sum.html">psi_cost_path_sum</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="va">m.cost.path</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">step_1</span></span>
<span><span class="co">#&gt; [1] 39.44194</span></span></code></pre></div>
<p>Step <strong>2</strong> returns the distances between consecutive
samples within each time series, as computed by
<code><a href="../reference/psi_auto_sum.html">psi_auto_sum()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psi_auto_sum.html">psi_auto_sum</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">step_2</span></span></code></pre></div>
<p>Finally, in the step <strong>3</strong> we compute the normalized
dissimilarity score.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/psi_equation.html">psi_equation</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="va">step_1</span>,</span>
<span>  b <span class="op">=</span> <span class="va">step_2</span>,</span>
<span>  diagonal <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>All these individual steps can be performed at once with the function
<code><a href="../reference/distantia.html">distantia()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#default, lock step disabled</span></span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span> <span class="co">#default</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y      psi</span></span>
<span><span class="co">#&gt; 1 London Kinshasa 1.153969</span></span></code></pre></div>
<p>Additionally, the function <code><a href="../reference/distantia_plot.html">distantia_plot()</a></code> offers a
good graphical representation of the warping result and decomposes the
computation of the <em>psi</em> dissimilarity score.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_plot.html">distantia_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-18-1.png" width="1800"></p>
<div class="section level3">
<h3 id="pitfalls">Pitfalls<a class="anchor" aria-label="anchor" href="#pitfalls"></a>
</h3>
<p>DTW is an ideal method to compare time series with temporal shifts,
and is applicable to regular and irregular time series with the same or
different numbers of samples.</p>
<p>However, <strong>DTW is highly sensitive to differences in ata
magnitudes</strong>. When the data is not scaled and/or centered, the
sensitivity to data magnitude of DTW may lead to local optima able to
distort the warping.</p>
<p>The plot below represents the DTW alignment of London and Kinshasa on
the raw temperature data. It shows two of these local optima, one in the
<em>y</em> axis (long horizontal line), at the minimum temperature in
Kinshasa (winter of 2001), and another in the <em>x</em> axis (long
vertical line), at the maximum temperature in London (summer of
2003).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/distantia_plot.html">distantia_plot</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"London"</span>, <span class="st">"Kinshasa"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-19-1.png" width="1800"></p>
<p>This is not a particular issue of the algorithm implemented in
<code>distantia</code>, but a general behavior of time warping methods.
The code below shows a similar analysis performed with the R package <a href="https://CRAN.R-project.org/package=dtw" class="external-link"><code>dtw</code></a>. The
default implementation ignores diagonals when building the cost
matrix.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_dtw</span> <span class="op">&lt;-</span> <span class="fu">dtw</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dtw/man/dtw.html" class="external-link">dtw</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">$</span><span class="va">London</span><span class="op">$</span><span class="va">temperature</span>,</span>
<span>  y <span class="op">=</span> <span class="va">tsl_raw</span><span class="op">$</span><span class="va">Kinshasa</span><span class="op">$</span><span class="va">temperature</span>,</span>
<span>  keep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xy_dtw</span>, type <span class="op">=</span> <span class="st">"threeway"</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-20-1.png" width="1500"></p>
<p>The “twoway” plot provided by <code>dtw</code> shows the alingment as
a line bar, with the sample matches represented as dotted lines, and two
vertical lines highlighting the local optima</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xy_dtw</span>, type <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0.13</span>, col<span class="op">=</span><span class="st">"red3"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0.70</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="dynamic_time_warping_and_lock_step_files/figure-html/unnamed-chunk-21-1.png" width="2187.5"></p>
</div>
</div>
<div class="section level2">
<h2 id="comparing-dtw-and-ls">Comparing DTW and LS<a class="anchor" aria-label="anchor" href="#comparing-dtw-and-ls"></a>
</h2>
<p>Dynamic Time Warping (DTW) and Lock-Step (LS) methods differ in scope
and application.</p>
<p>DTW is ideal for comparing data that may be shifted in time due to
positional differences, such as phenological time series observed across
different hemispheres or elevations. It also facilitates the comparison
of time series with varying lengths, observation periods, or sampling
resolutions. This versatility makes DTW a general-purpose tool for time
series analysis.</p>
<p>In contrast, LS is designed for synchronized time series that, at a
minimum, must have the same length. While its scope is narrower, LS is
more intuitive and accurate than DTW for comparing time series without
time shifts, as it measures raw differences directly.</p>
<p>In essence, DTW, with its ability to adjust the time axis, answers
the question, <em>How similar can these two time series be?</em>, while
LS addresses the question, “How different are these two time
series?”</p>
<p>The code below computes the dissimilarity score of the temperatures
in Paris, London, and Kinshasa using DTW and LS and compares them in a
data frame.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_dtw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_scaled</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">df_dtw</span><span class="op">$</span><span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">df_dtw</span><span class="op">$</span><span class="va">y</span>,</span>
<span>  psi_dtw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">df_dtw</span><span class="op">$</span><span class="va">psi</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  psi_ls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">df_ls</span><span class="op">$</span><span class="va">psi</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;        x        y psi_dtw psi_ls</span></span>
<span><span class="co">#&gt; 1 London    Paris   0.223  0.243</span></span>
<span><span class="co">#&gt; 2 London Kinshasa   1.154  2.715</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa   1.178  2.792</span></span></code></pre></div>
<p>For London and Paris, both DTW and LS show very similar values,
because the time series are very similar and DTW cannot do much else to
adjust them even more. On the other hand, DTW shows much lower values
than LS when Kinshasa comes into play, as it compensates the seasonal
shifts in these time series. In that sense, LS provides a more accurate
image of the raw differences between these time series.</p>
<p>As a clear advantage, LS does not require data normalization for
univariate time series, and therefore can provide a dissimilarity score
in the same units of the variable at hand.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distantia.html">distantia</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  lock_step <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_ls</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;        x        y       psi</span></span>
<span><span class="co">#&gt; 1 London    Paris 0.4879081</span></span>
<span><span class="co">#&gt; 3  Paris Kinshasa 7.5416106</span></span>
<span><span class="co">#&gt; 2 London Kinshasa 9.3361647</span></span></code></pre></div>
<p>Comparing the dissimilarity scores above with the mean temperatures
of the three cities below can give a sense of how approximate LS scores
are to what we could expect.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsl_stats.html">tsl_stats</a></span><span class="op">(</span></span>
<span>  tsl <span class="op">=</span> <span class="va">tsl_raw</span>,</span>
<span>  lags <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_stats</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;       name     mean</span></span>
<span><span class="co">#&gt; 1   London 10.55682</span></span>
<span><span class="co">#&gt; 2    Paris 11.53803</span></span>
<span><span class="co">#&gt; 3 Kinshasa 24.48500</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="closing-thoughts">Closing Thoughts<a class="anchor" aria-label="anchor" href="#closing-thoughts"></a>
</h2>
<p>The <code>distantia</code> package strikes a balance between
flexibility and simplicity, enabling a more nuanced exploration of time
series data. With support for both dynamic time warping and lock-step
methods, it provides users with the tools needed to uncover insights
while respecting the unique constraints of their data. Whether you’re
working on sequence alignment or strict temporal comparisons,
<code>distantia</code> is designed to adapt to your analytical
needs.</p>
<p>I encourage you to give it a try and see how it fits into your
workflows.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
